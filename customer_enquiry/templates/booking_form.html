<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Application Form - {{ customer.get_full_name }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.4;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border: 3px solid #ffd700;
            border-radius: 10px;
            overflow: hidden;
        }

        .customer-info-bar {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            padding: 15px 20px;
            margin-bottom: 0;
        }

        .customer-info-bar h3 {
            margin-bottom: 10px;
            color: #fff;
        }

        .customer-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .customer-details p {
            margin: 5px 0;
        }

        .form-header {
            background: #ffd700;
            text-align: center;
            padding: 20px;
            border-bottom: 2px solid #333;
        }

        .form-header h1 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .project-info {
            background: #ffe6e6;
            border: 2px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .project-info input {
            border: none;
            background: transparent;
            font-weight: bold;
            width: 250px;
        }

        .form-content {
            padding: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            border: 2px solid #000;
            padding: 20px;
            border-radius: 8px;
        }

        .section-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 15px;
            text-decoration: underline;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        .form-row.double {
            grid-template-columns: 1fr 1fr;
        }

        .form-row.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.inline {
            flex-direction: row;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .mandatory {
            color: red;
            font-weight: bold;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            padding: 8px;
            border: 1px solid #000;
            border-radius: 3px;
            font-size: 14px;
            background: white;
        }

        /* Pre-filled fields styling */
        .prefilled {
            background: #f0f8ff !important;
            border-color: #007bff;
            position: relative;
        }

        .prefilled::after {
            content: "📄";
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="date"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }

        .checkbox-group,
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            width: 16px;
            height: 16px;
        }

        .applicant-section {
            background: #fff0f0;
            border: 2px solid #ff0000;
            margin: 20px 0;
            padding: 20px;
            border-radius: 5px;
        }

        .applicant-section.hidden {
            display: none;
        }

        .applicant-title {
            background: #ff0000;
            color: white;
            padding: 10px;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
            text-align: center;
            position: relative;
        }

        .prefilled-indicator {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .add-applicant-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }

        .add-applicant-btn:hover {
            background: #1e7e34;
        }

        .remove-applicant-btn {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            float: right;
            margin-top: -10px;
        }

        .remove-applicant-btn:hover {
            background: #c82333;
        }

        .warning-box {
            background: #ffe6e6;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            color: #d63384;
            font-weight: bold;
            text-align: center;
            border: 1px solid #f5c6cb;
        }

        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .payment-table th,
        .payment-table td {
            border: 1px solid #000;
            padding: 10px;
            text-align: left;
        }

        .payment-table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        .auto-fill-cell {
            background: #ffe6e6 !important;
            color: red;
            font-weight: bold;
        }

        .terms-section {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 12px;
            line-height: 1.6;
        }

        .signature-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .signature-box {
            text-align: center;
            padding: 20px 0;
        }

        .signature-line {
            border-bottom: 1px solid #000;
            height: 40px;
            margin-bottom: 10px;
        }

        .submit-btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 15px 40px;
            border: 2px solid #333;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .company-info {
            background: #e6f3ff;
            border: 2px solid #007bff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            display: inline-block;
            margin-bottom: 20px;
            transition: background 0.3s ease;
        }

        .back-btn:hover {
            background: #5a6268;
            color: white;
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .signature-section {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
            }
            
            .form-content {
                padding: 15px;
            }

            .customer-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Back Button -->
        <div style="padding: 20px 20px 0 20px;">
            <a href="{% url 'customer_enquiry:dashboard' %}" class="back-btn">← Back to Dashboard</a>
        </div>

        <!-- Customer Information Bar -->
        <div class="customer-info-bar">
            <h3>Customer Information:</h3>
            <div class="customer-details">
                <p><strong>Name:</strong> {{ customer.get_full_name }}</p>
                <p><strong>Form Number:</strong> {{ customer.form_number }}</p>
                <p><strong>Email:</strong> {{ customer.email }}</p>
                <p><strong>City:</strong> {{ customer.city }}</p>
                <p><strong>Configuration:</strong> {{ customer.get_configuration_display }}</p>
                <p><strong>Budget:</strong> {{ customer.get_budget_display }}</p>
            </div>
        </div>

        <!-- Form Header -->
        <div class="form-header">
            <h1>BOOKING APPLICATION FORM</h1>
            <div class="project-info">
                <label>Project Name:</label>
                <input type="text" name="project_name" id="projectName" value="{{ prefilled_data.project_name|default:'Default Project Name' }}" readonly>
                <span style="color: red; margin-left: 20px;">Customized form will open as per selected project</span>
            </div>
        </div>

        <div class="form-content">
            <form id="bookingForm" method="POST">
                {% csrf_token %}

                <!-- Application Date -->
                <div class="form-row single">
                    <div class="form-group">
                        <label>Application Date:</label>
                        <input type="date" name="application_date" id="applicationDate" required>
                    </div>
                </div>

                <!-- Flat Details Section -->
                <div class="form-section">
                    <div class="section-title">BOOKING APPLICATION FOR THE FLAT:</div>
                    
                    <div class="form-row triple">
                        <div class="form-group">
                            <label>Flat No.: <span class="mandatory">*</span></label>
                            <input type="text" name="flat_number" required>
                        </div>
                        <div class="form-group">
                            <label>Floor: <span class="mandatory">*</span></label>
                            <input type="text" name="floor" required>
                        </div>
                        <div class="form-group">
                            <label>RERA Carpet Area: <span class="mandatory">*</span></label>
                            <input type="number" name="rera_carpet_area" step="0.01" placeholder="Sq.ft" required>
                        </div>
                    </div>

                    <div class="form-row double">
                        <div class="form-group">
                            <label>Exclusive Deck/Balcony:</label>
                            <input type="number" name="exclusive_deck_balcony" step="0.01" placeholder="Sq.ft">
                        </div>
                        <div class="form-group">
                            <label>No. of car parking(s): <span class="mandatory">*</span></label>
                            <input type="number" name="car_parking_count" min="0" required>
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Total Purchase Price: <span class="mandatory">*</span></label>
                            <input type="number" name="total_purchase_price" step="0.01" id="totalPrice" required>
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>(in words): Rupees <span class="mandatory">*</span></label>
                            <input type="text" name="total_purchase_price_words" id="priceInWords" placeholder="Enter amount in words" required>
                        </div>
                    </div>

                    <div class="form-row single">
                        <label>Kindly refer to Annexure 'A' for payment schedule.</label>
                    </div>

                    <div class="form-row single">
                        <label>Source of Funds:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" name="source_of_funds" value="self_financed" id="selfFinanced">
                                <label for="selfFinanced">Self Financed</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" name="source_of_funds" value="housing_loan" id="housingLoan">
                                <label for="housingLoan">Housing Loan</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1st Applicant Details (Pre-filled) -->
                <div class="applicant-section">
                    <div class="applicant-title">
                        1st APPLICANT DETAILS 
                        <span class="prefilled-indicator">✓ Auto-filled from Customer Data</span>
                    </div>
                    
                    <div class="form-row triple">
                        <div class="form-group">
                            <label>Title: <span class="mandatory">*</span></label>
                            <select name="applicant_1_title" class="prefilled" required title="Pre-filled from customer data">
                                <option value="">Select</option>
                                <option value="Mr" {% if prefilled_data.applicant_1_title == 'Mr' %}selected{% endif %}>Mr.</option>
                                <option value="Ms" {% if prefilled_data.applicant_1_title == 'Ms' %}selected{% endif %}>Ms.</option>
                                <option value="Mrs" {% if prefilled_data.applicant_1_title == 'Mrs' %}selected{% endif %}>Mrs.</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>First Name: <span class="mandatory">*</span></label>
                            <input type="text" name="applicant_1_first_name" value="{{ prefilled_data.applicant_1_first_name|default:'' }}" class="prefilled" required title="Pre-filled from customer data">
                        </div>
                        <div class="form-group">
                            <label>Middle Name:</label>
                            <input type="text" name="applicant_1_middle_name" value="{{ prefilled_data.applicant_1_middle_name|default:'' }}" class="prefilled" title="Pre-filled from customer data">
                        </div>
                    </div>

                    <div class="form-row double">
                        <div class="form-group">
                            <label>Last Name: <span class="mandatory">*</span></label>
                            <input type="text" name="applicant_1_last_name" value="{{ prefilled_data.applicant_1_last_name|default:'' }}" class="prefilled" required title="Pre-filled from customer data">
                        </div>
                        <div class="form-group">
                            <label>Date of Birth: <span class="mandatory">*</span></label>
                            <input type="date" name="applicant_1_date_of_birth" required>
                        </div>
                    </div>

                    <div class="form-row double">
                        <div class="form-group">
                            <label>Marital Status: <span class="mandatory">*</span></label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_marital_status" value="married" id="married1" required>
                                    <label for="married1">Married</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_marital_status" value="unmarried" id="unmarried1">
                                    <label for="unmarried1">Unmarried</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_marital_status" value="other" id="other1">
                                    <label for="other1">Other</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Date of Anniversary:</label>
                            <input type="date" name="applicant_1_anniversary">
                        </div>
                    </div>

                    <div class="form-row double">
                        <div class="form-group">
                            <label>Sex: <span class="mandatory">*</span></label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_sex" value="male" id="male1" required>
                                    <label for="male1">Male</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_sex" value="female" id="female1">
                                    <label for="female1">Female</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_sex" value="others" id="others1">
                                    <label for="others1">Others</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>PAN No.: <span class="mandatory">*</span></label>
                            <input type="text" name="applicant_1_pan_no" maxlength="10" placeholder="ABCDE1234F" required>
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Aadhar Card No.:</label>
                            <input type="text" name="applicant_1_aadhar_no" maxlength="12" placeholder="123456789012">
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Residential Status: <span class="mandatory">*</span></label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_residential_status" value="indian" id="indian1" 
                                           {% if prefilled_data.applicant_1_residential_status == 'indian' %}checked{% endif %} required>
                                    <label for="indian1">Indian</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_residential_status" value="nri" id="nri1"
                                           {% if prefilled_data.applicant_1_residential_status == 'nri' %}checked{% endif %}>
                                    <label for="nri1">NRI</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_residential_status" value="pio" id="pio1"
                                           {% if prefilled_data.applicant_1_residential_status == 'pio' %}checked{% endif %}>
                                    <label for="pio1">PIO</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_residential_status" value="oci" id="oci1"
                                           {% if prefilled_data.applicant_1_residential_status == 'oci' %}checked{% endif %}>
                                    <label for="oci1">OCI</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Residential Address: <span class="mandatory">*</span></label>
                            <textarea name="applicant_1_residential_address" rows="3" class="prefilled" required title="Pre-filled from customer data">{{ prefilled_data.applicant_1_residential_address|default:'' }}</textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>City: <span class="mandatory">*</span></label>
                            <input type="text" name="applicant_1_city" value="{{ prefilled_data.applicant_1_city|default:'' }}" class="prefilled" required title="Pre-filled from customer data">
                        </div>
                        <div class="form-group">
                            <label>Pin: <span class="mandatory">*</span></label>
                            <input type="text" name="applicant_1_pin" value="{{ prefilled_data.applicant_1_pin|default:'' }}" maxlength="6" class="prefilled" required title="Pre-filled from customer data">
                        </div>
                        <div class="form-group">
                            <label>State: <span class="mandatory">*</span></label>
                            <input type="text" name="applicant_1_state" value="{{ prefilled_data.applicant_1_state|default:'Maharashtra' }}" class="prefilled" required title="Pre-filled from customer data">
                        </div>
                        <div class="form-group">
                            <label>Country: <span class="mandatory">*</span></label>
                            <input type="text" name="applicant_1_country" value="{{ prefilled_data.applicant_1_country|default:'India' }}" class="prefilled" required title="Pre-filled from customer data">
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Correspondence Address:</label>
                            <textarea name="applicant_1_correspondence_address" rows="3"></textarea>
                        </div>
                    </div>

                    <div class="form-row triple">
                        <div class="form-group">
                            <label>Contact No. - Residence:</label>
                            <input type="tel" name="applicant_1_contact_residence">
                        </div>
                        <div class="form-group">
                            <label>Office:</label>
                            <input type="tel" name="applicant_1_contact_office">
                        </div>
                        <div class="form-group">
                            <label>Mobile: <span class="mandatory">*</span></label>
                            <input type="tel" name="applicant_1_mobile" maxlength="10" required>
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>E-mail Id: <span class="mandatory">*</span></label>
                            <input type="email" name="applicant_1_email" value="{{ prefilled_data.applicant_1_email|default:'' }}" class="prefilled" required title="Pre-filled from customer data">
                        </div>
                    </div>

                    <div class="form-row double">
                        <div class="form-group">
                            <label>Employment Type: <span class="mandatory">*</span></label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_employment_type" value="salaried" id="salaried1" 
                                           {% if prefilled_data.applicant_1_employment_type == 'salaried' %}checked{% endif %} required>
                                    <label for="salaried1">Salaried</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="applicant_1_employment_type" value="self_employed" id="selfEmployed1"
                                           {% if prefilled_data.applicant_1_employment_type == 'self_employed' %}checked{% endif %}>
                                    <label for="selfEmployed1">Self Employed</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Profession/Job Title:</label>
                            <input type="text" name="applicant_1_profession" value="{{ prefilled_data.applicant_1_profession|default:'' }}" class="prefilled" title="Pre-filled from customer data">
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Company Name:</label>
                            <input type="text" name="applicant_1_company_name" value="{{ prefilled_data.applicant_1_company_name|default:'' }}" class="prefilled" title="Pre-filled from customer data">
                        </div>
                    </div>
                </div>

                <!-- Add Applicants Button -->
                <div class="form-row single">
                    <button type="button" class="add-applicant-btn" onclick="addApplicant()">
                        ➕ ADD APPLICANTS
                    </button>
                </div>

                <!-- Additional Applicant Sections (Hidden by default) -->
                <div id="applicant2" class="applicant-section hidden">
                    <div class="applicant-title">
                        2nd APPLICANT DETAILS
                        <button type="button" class="remove-applicant-btn" onclick="removeApplicant(2)">✖ Remove</button>
                    </div>
                    <div class="warning-box">This section only comes if Add applicant is selected</div>
                    
                    <!-- Same structure as 1st applicant but with applicant_2_ prefix -->
                    <div class="form-row triple">
                        <div class="form-group">
                            <label>Title:</label>
                            <select name="applicant_2_title">
                                <option value="">Select</option>
                                <option value="Mr">Mr.</option>
                                <option value="Ms">Ms.</option>
                                <option value="Mrs">Mrs.</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>First Name:</label>
                            <input type="text" name="applicant_2_first_name">
                        </div>
                        <div class="form-group">
                            <label>Middle Name:</label>
                            <input type="text" name="applicant_2_middle_name">
                        </div>
                    </div>
                    
                    <div class="form-row double">
                        <div class="form-group">
                            <label>Last Name:</label>
                            <input type="text" name="applicant_2_last_name">
                        </div>
                        <div class="form-group">
                            <label>Date of Birth:</label>
                            <input type="date" name="applicant_2_date_of_birth">
                        </div>
                    </div>
                    
                    <!-- Add all other fields similar to 1st applicant -->
                    <div class="form-row single">
                        <div class="form-group">
                            <label>Mobile:</label>
                            <input type="tel" name="applicant_2_mobile" maxlength="10">
                        </div>
                    </div>
                    
                    <div class="form-row single">
                        <div class="form-group">
                            <label>E-mail:</label>
                            <input type="email" name="applicant_2_email">
                        </div>
                    </div>
                </div>

                <!-- Similar structure for 3rd and 4th applicants -->
                <div id="applicant3" class="applicant-section hidden">
                    <div class="applicant-title">
                        3rd APPLICANT DETAILS
                        <button type="button" class="remove-applicant-btn" onclick="removeApplicant(3)">✖ Remove</button>
                    </div>
                    <div class="warning-box">This section only comes if Add applicant is selected</div>
                    <!-- Fields with applicant_3_ prefix -->
                </div>

                <div id="applicant4" class="applicant-section hidden">
                    <div class="applicant-title">
                        4th APPLICANT DETAILS
                        <button type="button" class="remove-applicant-btn" onclick="removeApplicant(4)">✖ Remove</button>
                    </div>
                    <div class="warning-box">This section only comes if Add applicant is selected</div>
                    <!-- Fields with applicant_4_ prefix -->
                </div>

                <!-- Channel Partner Section -->
                <div class="form-section">
                    <div class="section-title">INCASE OF CHANNEL PARTNER</div>
                    
                    <div class="form-row double">
                        <div class="form-group">
                            <label>Name of the Channel Partner:</label>
                            <input type="text" name="channel_partner_name">
                        </div>
                        <div class="form-group">
                            <label>Channel Partner MahaRERA Registration Number:</label>
                            <input type="text" name="channel_partner_rera">
                        </div>
                    </div>

                    <div class="form-row double">
                        <div class="form-group">
                            <label>Mobile no.:</label>
                            <input type="tel" name="channel_partner_mobile" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label>E-mail ID:</label>
                            <input type="email" name="channel_partner_email">
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Signature of Channel Partner:</label>
                            <div class="signature-line"></div>
                        </div>
                    </div>
                </div>

                <!-- Source of Booking -->
                <div class="form-section">
                    <div class="section-title">SOURCE OF BOOKING</div>
                    
                    <div class="form-row single">
                        <div class="form-group inline">
                            <input type="checkbox" name="source_direct" id="sourceDirect">
                            <label for="sourceDirect">Direct</label>
                            <label>Please specify:</label>
                            <input type="text" name="source_direct_specify" placeholder="Please specify">
                        </div>
                    </div>

                    <div class="section-title" style="margin-top: 20px;">INCASE OF REFERRAL</div>
                    
                    <div class="form-row double">
                        <div class="form-group">
                            <label>Customer Name:</label>
                            <input type="text" name="referral_customer_name">
                        </div>
                        <div class="form-group">
                            <label>Project:</label>
                            <input type="text" name="referral_project">
                        </div>
                    </div>

                    <div class="form-row single">
                        <div class="form-group">
                            <label>Flat No.:</label>
                            <input type="text" name="referral_flat_no">
                        </div>
                    </div>
                </div>

                <!-- Payment Table -->
                <div class="form-section">
                    <div class="section-title">PAYMENT DETAILS</div>
                    <p style="margin-bottom: 15px;">I/We remit herewith amounts towards 'Application Money' and 'GST' as stated in the table hereunder.</p>
                    
                    <table class="payment-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Towards 'Application Money'</th>
                                <th>Towards 'GST'</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Favouring</td>
                                <td class="auto-fill-cell">Auto filled as per selected Project</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Amount</td>
                                <td><input type="number" name="application_money_amount" step="0.01"></td>
                                <td><input type="number" name="gst_amount" step="0.01"></td>
                            </tr>
                            <tr>
                                <td>Amount (In Words)</td>
                                <td><input type="text" name="application_money_words"></td>
                                <td><input type="text" name="gst_words"></td>
                            </tr>
                            <tr>
                                <td>Cheque/Demand Draft No.</td>
                                <td><input type="text" name="cheque_dd_no"></td>
                                <td><input type="text" name="gst_cheque_dd_no"></td>
                            </tr>
                            <tr>
                                <td>Date of Instrument</td>
                                <td><input type="date" name="instrument_date"></td>
                                <td><input type="date" name="gst_instrument_date"></td>
                            </tr>
                            <tr>
                                <td>Drawn On</td>
                                <td><input type="text" name="drawn_on"></td>
                                <td><input type="text" name="gst_drawn_on"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Terms and Conditions -->
                <div class="terms-section">
                    <div class="section-title">TERMS AND CONDITIONS</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        <p style="margin-bottom: 10px;">1) The Applicant/s hereby request to be registered for provisional allotment of a Residential Apartment/Flat (as mentioned in the Booking Application Form) in the Project known as <span style="background: #ffcccc;">[Project Name]</span> situated at <span style="background: #ffcccc;">[Location]</span>, to be developed by Heston Builders Pvt. Ltd., hereinafter referred as "The Promoter"</p>
                        
                        <p style="margin-bottom: 10px; background: #ffe6e6; color: red; font-weight: bold; padding: 5px; border-radius: 3px; text-align: center;">Will be customized as per the project selected</p>

                        <p style="margin-bottom: 10px;"><strong>I/We have fully read, understood and agree to abide by the above mentioned terms and conditions stipulated by</strong></p>
                        <p style="margin-bottom: 20px; background: #ffe6e6; color: red; font-weight: bold; padding: 5px; border-radius: 3px; text-align: center;">Heston Builders Private Ltd. - As per selected Project</p>
                    </div>
                </div>

                <!-- Signatures -->
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <label>Signature of 1st Applicant</label>
                    </div>
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <label>Signature of 2nd Applicant</label>
                    </div>
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <label>Signature of 3rd Applicant</label>
                    </div>
                </div>

                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <label>Signature of 4th Applicant</label>
                    </div>
                </div>

                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <label>Signature of Sales Manager</label>
                        <input type="text" name="sales_manager_name" placeholder="Name of Sales Manager" style="margin-top: 10px;">
                    </div>
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <label>Signature of Sourcing Manager</label>
                        <input type="text" name="sourcing_manager_name" placeholder="Name of Sourcing Manager" style="margin-top: 10px;">
                    </div>
                </div>

                <!-- Company Information -->
                <div class="company-info">
                    <p style="background: #ffe6e6; color: red; font-weight: bold; padding: 5px; border-radius: 3px; margin-bottom: 10px;">As per selected Project</p>
                    <p><strong>Registered Office:</strong> Heston Builders Private Ltd. 463, Sant Veer Meghmaya Road, Bhatt Chawl, Bane Compound, Tardeo, Mumbai- 400034.</p>
                    <p><strong>MahaRERA Registration Number:</strong> P51900053358, Available at website: http://maharera.mahaonline.gov.in</p>
                    <p style="margin-top: 10px;"><em>Disclaimer: The company reserves the right to make modifications, changes or alterations at their sole discretion without any prior notice or reference.</em></p>
                </div>

                <!-- Final Customer Signature -->
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <label>Customer Signature:</label>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-btn" id="submitBookingBtn">
                    📄 SUBMIT BOOKING APPLICATION & GENERATE PDF
                </button>
            </form>
        </div>
    </div>

    <script>
      // Updated form submission handler
document.getElementById('bookingForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submitBookingBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '⏳ Processing & Generating PDF...';
    
    // Get form data
    const formData = new FormData(this);
    
    console.log('Submitting form data...'); // Debug log
    
    // Submit to Django backend
    fetch(window.location.href, {  // Use current URL instead of empty string
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': formData.get('csrfmiddlewaretoken'), // Ensure CSRF token
        }
    })
    .then(response => {
        console.log('Response status:', response.status); // Debug log
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return response.json();
    })
    .then(data => {
        console.log('Response data:', data); // Debug log
        
        if (data.success) {
            alert('✅ Booking application submitted successfully!\n\n📄 PDF will be generated shortly.');
            if (data.redirect_url) {
                window.location.href = data.redirect_url;
            }
        } else {
            alert('❌ Error: ' + (data.error || 'Something went wrong'));
        }
    })
    .catch(error => {
        console.error('Error details:', error); // Enhanced error logging
        alert('🚫 Network error: ' + error.message + '\n\nPlease check your connection and try again.');
    })
    .finally(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '📄 SUBMIT BOOKING APPLICATION & GENERATE PDF';
    });
});
    </script>
</body>
</html>