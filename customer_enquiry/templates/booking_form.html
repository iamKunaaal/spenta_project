<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Application Form</title>
    
    <!-- html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --gold: #f0c24f;
            --ink: #222;
            --muted: #6e6e6e;
            --rule: #9e9e9e;
            --frame: #f3cc69;
            --bg: #000000;
            --red: #e21c22;
        }

        /* Page canvas */
        html,
        body {
            background: var(--bg);
            margin: 0;
        }

        .page {
            width: 820px;
            margin: 22px auto;
            background: #fff;
            border: 6px solid var(--gold);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }

        .frame {
            margin: 10px;
            border: 1px solid var(--frame);
            padding: 18px 22px 26px;
        }

        /* Title */
        .title {
            text-align: center;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 700;
            color: var(--ink);
            letter-spacing: 0.5px;
            margin: 6px 0 14px;
            text-transform: uppercase;
        }

        /* Helpers */
        .row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .row.cols-2 {
            grid-template-columns: 1fr 1fr;
        }

        .row.cols-3 {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .row.cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .label {
            font: 500 14px/1.2 Arial, sans-serif;
            color: var(--ink);
        }

        .muted {
            color: var(--muted);
            font-weight: 500;
        }

        .section-head {
            font: 700 12px/1.2 Arial, sans-serif;
            color: #000;
            margin: 14px 0 6px;
        }

        /* Rule-line inputs */
        .line {
            width: 100%;
            border: none;
            border-bottom: 1px solid var(--rule);
            padding: 2px 4px 3px;
            font: 500 12px/1.2 Arial, sans-serif;
            color: #000;
            outline: none;
            background: transparent;
        }

        .line:focus {
            border-bottom-color: #666;
            background: transparent;
        }

        .line::placeholder {
            color: #bdbdbd;
            font-weight: 500;
        }

        .inline {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
            font: 500 14px/1.2 Arial, sans-serif;
            color: #000;
        }

        .inline .line {
            flex: 1 1 120px;
        }


        /* Check groups (square like screenshot) */
        .checks {
            display: flex;
            align-items: center;
            gap: 14px;
            flex-wrap: wrap;
        }

        .checks label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font: 500 12px Arial, sans-serif;
        }

        .checks input[type="checkbox"],
        .checks input[type="radio"] {
            appearance: none;
            width: 12px;
            height: 12px;
            border: 1px solid #444;
            display: inline-block;
            position: relative;
            margin: 0;
            border-radius: 2px;
            background: #fff;
        }

        .checks input[type="radio"] {
            border-radius: 50%;
        }

        .checks input:checked::after {
            content: "";
            position: absolute;
            inset: 2px;
            background: #222;
        }

        /* Character boxes (DOB, PAN, Aadhaar) */
        .char-grid {
            display: grid;
            gap: 4px;
            align-items: center;
            --size: 20px;
        }

        .char-grid.ddmmyyyy {
            grid-template-columns: repeat(10, var(--size));
        }

        /* dd / mm / yyyy + 2 dividers */
        .char-grid.pan {
            grid-template-columns: repeat(10, var(--size));
        }

        .char-grid.aadhaar {
            grid-template-columns: repeat(12, var(--size));
        }

        .char {
            width: var(--size);
            height: var(--size);
            border: 1px solid #444;
            text-align: center;
            font: 500 12px/1 Arial, sans-serif;
            outline: none;
            background: white;
        }

        .char:focus {
            border-color: #666;
            background: white;
        }

        .divider {
            width: 12px;
            text-align: center;
            font: 700 12px/1 Arial, sans-serif;
            color: #444;
        }

        /* Multi-line address */
        .multiline {
            height: 42px;
            border: none;
            border-bottom: 1px solid var(--rule);
            resize: none;
            outline: none;
            font: 500 12px Arial, sans-serif;
            background: transparent;
        }

        /* Red badges/bars and boxes */
        .red-chip {
            border: 1px solid var(--red);
            color: var(--red);
            font: 500 11px/1.4 Arial, sans-serif;
            padding: 6px 8px;
            display: inline-block;
            white-space: nowrap;
        }

        .add-btn {
            display: inline-block;
            padding: 6px 10px;
            margin: 8px 0 10px;
            border: 1px solid var(--red);
            color: var(--red);
            background: #fff;
            font: 700 11px Arial, sans-serif;
            cursor: pointer;
            user-select: none;
            text-align: center;
            width: 100%;
        }

        .applicant-box {
            border: 1px solid var(--red);
            padding: 10px 12px;
            margin: 10px 0;
        }

        .applicant-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 6px;
        }

        .applicant-head .note {
            color: var(--red);
            font: 700 11px Arial, sans-serif;
        }

        /* Grid-fit (label + input line) */
        .grid-fit {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px;
            align-items: center;
        }

        .grid-fit>.label {
            white-space: nowrap;
        }

        /* Channel partner + signatures */
        .underline-holder {
            display: inline-block;
            min-width: 280px;
            border-bottom: 1px solid var(--rule);
            height: 16px;
        }

        .row.cols-21 {
            grid-template-columns: 1fr;
        }

        .grid-fit-21 {
            display: flex;
        }

        .section-head-term {
            font: 700 17px / 1.2 Arial, sans-serif;
            color: #000;
            margin: 70px 0 26px;
            text-align: center;
            border-top: 1px solid #000;
            padding-top: 80px;
        }

        /* PDF Page Break Controls - Only for PDF, won't affect screen layout */
        .page-break-before {
            page-break-before: always !important;
            break-before: page !important;
        }

        /* Hide elements from PDF generation only - keeps them visible on screen */
        .hide-from-pdf {
            /* Elements remain visible on screen, hidden only during PDF generation */
        }

        /* Add top margin to all pages starting from second page */
        .page-break-before {
            margin-top: 20px !important;
            padding-top: 20px !important;
        }


        .terms {
            font: 400 13px/1.6 Arial, sans-serif;
            color: #000;
            margin-top: 10px;
        }

        .terms p {
            margin: 6px 0;
            text-align: justify;
        }

        /* Print */
        @media print {
            body {
                background: #fff;
            }

            .page {
                box-shadow: none;
                margin: 0 auto;
            }

            .add-btn {
                display: none;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .page {
                width: 100%;
                margin: 12px auto;
                border-width: 4px;
                padding: 10px;
            }

            .frame {
                padding: 12px 14px 20px;
            }

            .row.cols-2,
            .row.cols-3,
            .row.cols-4 {
                grid-template-columns: 1fr !important;
            }

            .inline {
                flex-direction: row;
                align-items: flex-start;
            }

            .inline span {
                margin-top: 6px;
            }

            .char-grid {
                --size: 22px;
                justify-content: flex-start;
            }

            .char {
                font-size: 14px;
            }

            .grid-fit {
                grid-template-columns: 1fr !important;
            }

            .grid-fit-21 {
                flex-direction: column;
                gap: 6px;
            }

            .add-btn {
                font-size: 12px;
                padding: 8px;
                width: 95%;
            }

            .applicant-head {
                flex-direction: column;
                align-items: flex-start;
            }

            .section-head-term {
                margin: 40px 0 20px;
                padding-top: 40px;
                font-size: 14px;
            }

            .terms {
                font-size: 12px;
                line-height: 1.4;
            }

            table {
                font-size: 11px !important;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            /* Footer and signature sections */
            [style*="display: flex; justify-content: space-between;"] {
                flex-direction: column !important;
                gap: 32px;
                align-items: flex-start !important;
            }

            .underline-holder {
                min-width: 160px;
            }

            .footer-with-QR{
                gap:40px;
            }

            .fourth-app{
                text-align: left !important;
            }
        }

        /* PDF-specific styles */
        @media print {
            body {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .page {
                width: 100% !important;
                margin: 0 !important;
                background: white !important;
                border: 6px solid var(--gold) !important;
                box-shadow: none !important;
                page-break-inside: avoid;
            }
            
            /* Ensure form values are visible in PDF */
            input, select, textarea {
                -webkit-appearance: none !important;
                background: white !important;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            /* Hide non-essential elements in PDF */
            #downloadPdfBtn {
                display: none !important;
            }
            
            .customer-info-section {
                display: none !important;
            }
        }

        /* Enhanced styles for better PDF rendering */
        .page {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
        }
        
        /* Ensure form elements are visible in PDF */
        input, select, textarea {
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        input[type="radio"]:checked {
            appearance: none;
            -webkit-appearance: none;
        }
        
        input[type="radio"]:checked::after {
            content: "●";
            color: black;
            font-size: 12px;
            position: absolute;
            top: -1px;
            left: 2px;
        }
        
        input[type="checkbox"]:checked {
            appearance: none;
            -webkit-appearance: none;
        }
        
        input[type="checkbox"]:checked::after {
            content: "✓";
            color: black;
            font-weight: bold;
            position: absolute;
            top: -2px;
            left: 1px;
        }


        /* PDF Page Breaks for Sections */
        .page-break-before {
            page-break-before: always !important;
            break-before: page !important;
        }
        
        .page-break-after {
            page-break-after: always !important;
            break-after: page !important;
        }
        
        /* Enhanced PDF Page Break Rules for Long Content */
        @media print {
            /* Page breaks for specific sections */
            .applicant-box {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            .section-head-term {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            @page {
                margin: 0.2in;
                size: A3;
            }
            
            /* Main container should allow natural page breaks */
            .page {
                page-break-inside: auto;
                break-inside: auto;
            }
            
            /* Section headers can break before but not inside */
            .section-head, .section-head-term {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: auto;
                break-before: auto;
                orphans: 2;
                widows: 2;
            }
            
            /* Small form elements should stay together */
            .inline, .char-grid, .checks {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            /* Rows can break if needed but prefer to stay together */
            .row {
                page-break-inside: auto;
                break-inside: auto;
                orphans: 1;
                widows: 1;
            }
            
            /* Grid elements should stay together when small */
            .grid-fit {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            /* Applicant boxes should allow natural breaks */
            .applicant-box {
                page-break-inside: auto;
                break-inside: auto;
            }
            
            /* Terms section must allow breaking for long content */
            .terms {
                page-break-inside: auto;
                break-inside: auto;
            }
            
            .terms p {
                orphans: 2;
                widows: 2;
                page-break-inside: auto;
                break-inside: auto;
            }
            
            /* Input fields should not break in the middle */
            input, select, textarea {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            /* Labels with inputs should stay together when possible */
            .label {
                page-break-after: avoid;
                break-after: avoid;
            }
            
            /* Multiline textareas can break if very long */
            .multiline {
                page-break-inside: auto;
                break-inside: auto;
            }
        }

        /* Page break utility classes for manual control */
        .page-break-before {
            page-break-before: always;
            break-before: always;
        }
        
        .page-break-after {
            page-break-after: always;
            break-after: always;
        }
        
        .page-break-avoid {
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .page-break-auto {
            page-break-inside: auto;
            break-inside: auto;
        }

        /* Improved PDF layout */
        @page {
            size: A3 portrait;
            margin: 10mm 0;
        }
        
        /* Ensure content flows properly in PDF */
        .page {
            max-width: none !important;
            overflow: visible !important;
            height: auto !important;
        }
        
        .frame {
            overflow: visible !important;
            height: auto !important;
        }
        
        /* Better spacing for PDF */
        .row, .inline, .grid-fit {
            margin-bottom: 8px;
        }
        
        /* Ensure all text is visible */
        * {
            overflow: visible !important;
        }
    </style>
</head>
<body>
    <!-- Floating Back to Dashboard Button -->
    <a href="{% url 'customer_enquiry:dashboard' %}" id="floatingBackBtn" class="hide-from-pdf" style="
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
        color: #000;
        padding: 12px 18px;
        border-radius: 50px;
        text-decoration: none;
        font-size: 15px;
        font-weight: 600;
        box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 10px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
        min-width: 160px;
        justify-content: center;
    " onmouseover="
        this.style.transform='translateY(-3px) scale(1.05)';
        this.style.boxShadow='0 10px 25px rgba(255, 193, 7, 0.6)';
        this.style.background='linear-gradient(135deg, #ffca28 0%, #ffa000 100%)';
    " onmouseout="
        this.style.transform='translateY(0px) scale(1)';
        this.style.boxShadow='0 6px 20px rgba(255, 193, 7, 0.4)';
        this.style.background='linear-gradient(135deg, #ffc107 0%, #ffb300 100%)';
    ">
        <span style="font-size: 18px;">←</span>
        <span>Dashboard</span>
    </a>
    
    <div class="page">
        <div class="frame">
            <h2 class="title">BOOKING APPLICATION FORM</h2>
            <!-- Project row -->
            <div class="row cols-2" style="align-items: center">
                <div class="grid-fit">
                    <div class="label">Project Name:</div>
                    <input class="line" name="project_name" id="projectName" value="{{ prefilled_data.project_name }}" placeholder="Project Name" />
                </div>
                <div class="hide-from-pdf" style="text-align: right">
                    <span class="red-chip">Customized form will open as per selected project</span>
                </div>
            </div>
            
            <!-- Customer Information -->
            <div class="hide-from-pdf" style="background: #e6f3ff; border: 1px solid #007bff; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 12px;">
                <strong>Customer:</strong> {{ customer.get_full_name }} | 
                <strong>Form #:</strong> <span id="formNumber">{{ customer.form_number }}</span> | 
                <strong>Email:</strong> {{ customer.email }} |
                <strong>City:</strong> {{ customer.city }} | 
                <strong>Config:</strong> {{ customer.get_configuration_display }} | 
                <strong>Budget:</strong> {{ customer.get_budget_display }}
                <div style="margin-top: 5px;">
                    <button type="button" id="downloadPdfBtn" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px;">📄 Download PDF</button>
                </div>
            </div>
            <form id="bookingForm" method="POST">
                {% csrf_token %}
                
                <div class="grid-fit" style="margin-top: 10px">
                    <div class="label">Application Date:</div>
                    <input class="line" type="date" name="application_date" id="applicationDate" value="{% if existing_booking %}{{ existing_booking.application_date|date:'Y-m-d' }}{% else %}{% now 'Y-m-d' %}{% endif %}" style="max-width: 150px;" required>
                </div>
                
                <!-- Booking for flat -->
                <div class="section-head">BOOKING APPLICATION FOR THE FLAT:</div>
                <div class="inline">
                    <span>Flat No.:</span><input class="line" style="max-width: 60px" name="flat_number" value="{{ prefilled_data.flat_number|default:'' }}" required />
                    <span>Floor:</span><input class="line" style="max-width: 60px" name="floor" value="{{ prefilled_data.floor|default:'' }}" required />
                    <span>RERA Carpet Area:</span>
                    <input class="line" style="max-width: 60px" name="rera_carpet_area" step="0.01" value="{{ prefilled_data.rera_carpet_area|default:'' }}" required /><span class="muted">Sq.ft</span>
                    <span>Exclusive Deck/ Balcony:</span><input class="line" style="max-width: 60px" name="exclusive_deck_balcony" step="0.01" value="{{ prefilled_data.exclusive_deck_balcony|default:'' }}" /><span class="muted">Sq.ft</span>
                </div>
                <div class="inline" style="margin-top: 6px">
                    <span>No. of car parking(s):</span><input class="line" style="max-width: 160px" name="car_parking_count" min="0" value="{{ prefilled_data.car_parking_count|default:'' }}" required />
                </div>
                <div class="inline" style="margin-top: 6px">
                    <span>Total Purchase Price:</span><input class="line" name="total_purchase_price" step="0.01" id="totalPrice" value="{{ prefilled_data.total_purchase_price|default:'' }}" required />
                </div>
                <div class="inline" style="margin-top: 6px">
                    <span>(in words): Rupees</span><input class="line" name="total_purchase_price_words" id="priceInWords" value="{{ prefilled_data.total_purchase_price_words|default:'' }}" required />
                </div>
                <div class="label" style="margin-top: 10px">
                    Kindly refer to Annexure 'A' for payment schedule.
                </div>
                <div class="grid-fit" style="margin-top: 8px">
                    <div class="label">Source of Funds:</div>
                    <div class="checks">
                        <label><input type="checkbox" name="source_of_funds" value="self_financed" id="selfFinanced" {% if existing_booking.self_financed %}checked{% endif %} /> Self Financed</label>
                        <label><input type="checkbox" name="source_of_funds" value="housing_loan" id="housingLoan" {% if existing_booking.housing_loan %}checked{% endif %} /> Housing Loan</label>
                    </div>
                </div>

                <!-- 1st Applicant -->
                <div class="section-head" style="margin-top: 16px">
                    1<sup>st</sup> APPLICANT DETAILS
                </div>
                <div class="inline">
                    <span>Mr./Ms./Mrs.:</span><input class="line" style="min-width: 60px" name="applicant_1_title" value="{{ prefilled_data.applicant_1_title|default:customer.sex|default:'' }}" required />
                    <span>First Name:</span><input class="line" style="min-width: 60px" name="applicant_1_first_name" value="{{ prefilled_data.applicant_1_first_name|default:customer.first_name|default:'' }}" required />
                    <span>Middle Name:</span><input class="line" style="min-width: 60px" name="applicant_1_middle_name" value="{{ prefilled_data.applicant_1_middle_name|default:customer.middle_name|default:'' }}" /> <span>Last Name:</span><input class="line" style="min-width: 60px" name="applicant_1_last_name" value="{{ prefilled_data.applicant_1_last_name|default:customer.last_name|default:'' }}" required />
                </div>

                <div class="row cols-2" style="margin-top: 6px">
                    <div class="inline" style="align-items: center">
                        <span>Date of Birth:</span>
                        <div class="char-grid ddmmyyyy">
                            <input class="char" maxlength="1" name="applicant_1_dob_d1" value="{{ prefilled_data.applicant_1_dob_d1|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_dob_d2" value="{{ prefilled_data.applicant_1_dob_d2|default:'' }}" required />
                            <div class="divider">/</div>
                            <input class="char" maxlength="1" name="applicant_1_dob_m1" value="{{ prefilled_data.applicant_1_dob_m1|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_dob_m2" value="{{ prefilled_data.applicant_1_dob_m2|default:'' }}" required />
                            <div class="divider">/</div>
                            <input class="char" maxlength="1" name="applicant_1_dob_y1" value="{{ prefilled_data.applicant_1_dob_y1|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_dob_y2" value="{{ prefilled_data.applicant_1_dob_y2|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_dob_y3" value="{{ prefilled_data.applicant_1_dob_y3|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_dob_y4" value="{{ prefilled_data.applicant_1_dob_y4|default:'' }}" required />
                        </div>
                    </div>
                    <div class="inline">
                        <span>Date of Anniversary:</span>
                        <div class="char-grid ddmmyyyy">
                            <input class="char" maxlength="1" name="applicant_1_anniversary_d1" value="{{ prefilled_data.applicant_1_anniversary_d1|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_anniversary_d2" value="{{ prefilled_data.applicant_1_anniversary_d2|default:'' }}" />
                            <div class="divider">/</div>
                            <input class="char" maxlength="1" name="applicant_1_anniversary_m1" value="{{ prefilled_data.applicant_1_anniversary_m1|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_anniversary_m2" value="{{ prefilled_data.applicant_1_anniversary_m2|default:'' }}" />
                            <div class="divider">/</div>
                            <input class="char" maxlength="1" name="applicant_1_anniversary_y1" value="{{ prefilled_data.applicant_1_anniversary_y1|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_anniversary_y2" value="{{ prefilled_data.applicant_1_anniversary_y2|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_anniversary_y3" value="{{ prefilled_data.applicant_1_anniversary_y3|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_anniversary_y4" value="{{ prefilled_data.applicant_1_anniversary_y4|default:'' }}" />
                        </div>
                    </div>
                </div>
                <div class="inline" style="margin-top: 6px">
                    <span>Marital Status:</span>
                    <div class="checks">
                        <label><input type="radio" name="applicant_1_marital_status" value="married" {% if prefilled_data.applicant_1_marital_status == 'married' or customer.marital_status == 'married' %}checked{% endif %} /> Married</label>
                        <label><input type="radio" name="applicant_1_marital_status" value="unmarried" {% if prefilled_data.applicant_1_marital_status == 'unmarried' or customer.marital_status == 'single' %}checked{% endif %} /> Unmarried</label>
                        <label><input type="radio" name="applicant_1_marital_status" value="other" {% if prefilled_data.applicant_1_marital_status == 'other' or customer.marital_status == 'other' or customer.marital_status == 'divorced' or customer.marital_status == 'widowed' %}checked{% endif %} /> Other</label>
                    </div>
                </div>

                <div class="row cols-2" style="margin-top: 6px">
                    <div class="inline">
                        <span>Pan No.:</span>
                        <div class="char-grid pan">
                            <input class="char" maxlength="1" name="applicant_1_pan_1" value="{{ prefilled_data.applicant_1_pan_1|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_2" value="{{ prefilled_data.applicant_1_pan_2|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_3" value="{{ prefilled_data.applicant_1_pan_3|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_4" value="{{ prefilled_data.applicant_1_pan_4|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_5" value="{{ prefilled_data.applicant_1_pan_5|default:'' }}" required />
                            <input class="char" maxlength="1" name="applicant_1_pan_6" value="{{ prefilled_data.applicant_1_pan_6|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_7" value="{{ prefilled_data.applicant_1_pan_7|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_8" value="{{ prefilled_data.applicant_1_pan_8|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_9" value="{{ prefilled_data.applicant_1_pan_9|default:'' }}" required /><input class="char" maxlength="1" name="applicant_1_pan_10" value="{{ prefilled_data.applicant_1_pan_10|default:'' }}" required />
                        </div>
                    </div>
                    <div class="inline">
                        <span>Sex:</span>
                        <div class="checks">
                            <label><input type="radio" name="applicant_1_sex" value="male" {% if prefilled_data.applicant_1_sex == 'male' or customer.sex == 'male' %}checked{% endif %} /> Male</label>
                            <label><input type="radio" name="applicant_1_sex" value="female" {% if prefilled_data.applicant_1_sex == 'female' or customer.sex == 'female' %}checked{% endif %} /> Female</label>
                            <label><input type="radio" name="applicant_1_sex" value="others" {% if prefilled_data.applicant_1_sex == 'others' or customer.sex == 'other' %}checked{% endif %} /> Others</label>
                        </div>
                    </div>
                </div>
                <div class="inline" style="margin-top: 6px">
                    <span>Aadhar Card No.:</span>
                    <div class="char-grid aadhaar">
                        <input class="char" maxlength="1" name="applicant_1_aadhar_1" value="{{ prefilled_data.applicant_1_aadhar_1|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_2" value="{{ prefilled_data.applicant_1_aadhar_2|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_3" value="{{ prefilled_data.applicant_1_aadhar_3|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_4" value="{{ prefilled_data.applicant_1_aadhar_4|default:'' }}" />
                        <input class="char" maxlength="1" name="applicant_1_aadhar_5" value="{{ prefilled_data.applicant_1_aadhar_5|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_6" value="{{ prefilled_data.applicant_1_aadhar_6|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_7" value="{{ prefilled_data.applicant_1_aadhar_7|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_8" value="{{ prefilled_data.applicant_1_aadhar_8|default:'' }}" />
                        <input class="char" maxlength="1" name="applicant_1_aadhar_9" value="{{ prefilled_data.applicant_1_aadhar_9|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_10" value="{{ prefilled_data.applicant_1_aadhar_10|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_11" value="{{ prefilled_data.applicant_1_aadhar_11|default:'' }}" /><input class="char" maxlength="1" name="applicant_1_aadhar_12" value="{{ prefilled_data.applicant_1_aadhar_12|default:'' }}" />
                    </div>
                </div>

                <div class="inline" style="margin-top: 6px">
                    <span>Residential Status:</span>
                    <div class="checks">
                        <label><input type="radio" name="applicant_1_residential_status" value="indian" {% if prefilled_data.applicant_1_residential_status == 'indian' or customer.nationality == 'indian' %}checked{% endif %} /> Indian</label>
                        <label><input type="radio" name="applicant_1_residential_status" value="nri" {% if prefilled_data.applicant_1_residential_status == 'nri' or customer.nationality == 'nri' %}checked{% endif %} /> NRI</label>
                        <label><input type="radio" name="applicant_1_residential_status" value="pio" {% if prefilled_data.applicant_1_residential_status == 'pio' or customer.nationality == 'pio' %}checked{% endif %} /> PIO</label>
                        <label><input type="radio" name="applicant_1_residential_status" value="oci" {% if prefilled_data.applicant_1_residential_status == 'oci' or customer.nationality == 'oci' %}checked{% endif %} /> OCI</label>
                    </div>
                </div>

                <div class="grid-fit" style="margin-top: 6px">
                    <div class="label">Residential Address:</div>
                    <textarea class="multiline" name="applicant_1_residential_address" required>{{ prefilled_data.applicant_1_residential_address|default:customer.residential_address|default:'' }}</textarea>
                </div>

                <div class="row cols-4" style="margin-top: 6px">
                    <div class="grid-fit">
                        <div class="label">City:</div>
                        <input class="line" name="applicant_1_city" value="{{ prefilled_data.applicant_1_city|default:customer.city|default:'' }}" required />
                    </div>
                    <div class="grid-fit">
                        <div class="label">Pin:</div>
                        <input class="line" name="applicant_1_pin" value="{{ prefilled_data.applicant_1_pin|default:customer.pincode|default:'' }}" maxlength="6" required />
                    </div>
                    <div class="grid-fit">
                        <div class="label">State:</div>
                        <input class="line" name="applicant_1_state" value="{{ prefilled_data.applicant_1_state|default:'Maharashtra' }}" required />
                    </div>
                    <div class="grid-fit">
                        <div class="label">Country:</div>
                        <input class="line" name="applicant_1_country" value="{{ prefilled_data.applicant_1_country|default:'India' }}" required />
                    </div>
                </div>

                <div class="grid-fit" style="margin-top: 6px">
                    <div class="label">Correspondence Address:</div>
                    <textarea class="multiline" name="applicant_1_correspondence_address">{{ prefilled_data.applicant_1_correspondence_address|default:'' }}</textarea>
                </div>
                <div class="row cols-3" style="margin-top: 6px">
                    <div class="grid-fit">
                        <div class="label">Contact No.: Residence:</div>
                        <input class="line" name="applicant_1_contact_residence" value="{{ prefilled_data.applicant_1_contact_residence|default:'' }}" />
                    </div>
                    <div class="grid-fit">
                        <div class="label">Office:</div>
                        <input class="line" name="applicant_1_contact_office" value="{{ prefilled_data.applicant_1_contact_office|default:'' }}" />
                    </div>
                    <div class="grid-fit">
                        <div class="label">Mobile:</div>
                        <input class="line" name="applicant_1_mobile" maxlength="10" value="{{ prefilled_data.applicant_1_mobile|default:customer.phone_number|default:'' }}" required />
                    </div>
                </div>
                <div class="grid-fit" style="margin-top: 6px">
                    <div class="label">E-mail id:</div>
                    <input class="line" name="applicant_1_email" value="{{ prefilled_data.applicant_1_email|default:customer.email|default:'' }}" required />
                </div>
                <div class="row cols-2" style="margin-top: 6px">
                    <div class="grid-fit">
                        <div class="label">Employment Type:</div>
                        <div class="checks">
                            <label><input type="radio" name="applicant_1_employment_type" value="salaried" {% if prefilled_data.applicant_1_employment_type == 'salaried' or customer.employment_type == 'salaried' %}checked{% endif %} /> Salaried</label>
                            <label><input type="radio" name="applicant_1_employment_type" value="self_employed" {% if prefilled_data.applicant_1_employment_type == 'self_employed' or customer.employment_type == 'business' or customer.employment_type == 'professional' %}checked{% endif %} /> Self Employed</label>
                        </div>
                    </div>
                    <div class="grid-fit">
                        <div class="label">Company Name:</div>
                        <input class="line" name="applicant_1_company_name" value="{{ prefilled_data.applicant_1_company_name|default:customer.company_name|default:'' }}" />
                    </div>
                </div>
                <div class="grid-fit" style="margin-top: 6px">
                    <div class="label">Profession / Job Title:</div>
                    <input class="line" name="applicant_1_profession" value="{{ prefilled_data.applicant_1_profession|default:customer.designation|default:'' }}" />
                </div>

                <!-- Applicant 2 (red box + note) -->
                <div id="app2" class="applicant-box" style="display: block">
                    <div class="applicant-head">
                        <div class="section-head" style="margin: 0">
                            2<sup>nd</sup> APPLICANT DETAILS
                        </div>
                        <div class="note">
                            This section only comes if Add applicant is selected
                        </div>
                        <button type="button" class="remove-btn hide-from-pdf" onclick="removeApplicant('app2')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 11px; margin: 5px 0;">❌ Remove Applicant</button>
                    </div>
                    <div class="inline">
                        <span>Mr./Ms./Mrs.:</span><input class="line" style="min-width: 60px" name="applicant_2_title" value="{{ prefilled_data.applicant_2_title|default:'' }}" />
                        <span>First Name:</span><input class="line" style="min-width: 60px" name="applicant_2_first_name" value="{{ prefilled_data.applicant_2_first_name|default:'' }}" />
                        <span>Middle Name:</span><input class="line" style="min-width: 60px" name="applicant_2_middle_name" value="{{ prefilled_data.applicant_2_middle_name|default:'' }}" />
                        <span>Last Name:</span><input class="line" style="min-width: 60px" name="applicant_2_last_name" value="{{ prefilled_data.applicant_2_last_name|default:'' }}" />
                    </div>

                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="inline" style="align-items: center">
                            <span>Date of Birth:</span>
                            <!-- DEBUG: App2 DOB should be 15/03/2000: d1={{ prefilled_data.applicant_2_dob_d1|default:'EMPTY' }}, d2={{ prefilled_data.applicant_2_dob_d2|default:'EMPTY' }}, m1={{ prefilled_data.applicant_2_dob_m1|default:'EMPTY' }}, m2={{ prefilled_data.applicant_2_dob_m2|default:'EMPTY' }} -->
                            <div class="char-grid ddmmyyyy">
                                <input class="char" maxlength="1" name="applicant_2_dob_d1" value="{{ prefilled_data.applicant_2_dob_d1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_dob_d2" value="{{ prefilled_data.applicant_2_dob_d2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_2_dob_m1" value="{{ prefilled_data.applicant_2_dob_m1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_dob_m2" value="{{ prefilled_data.applicant_2_dob_m2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_2_dob_y1" value="{{ prefilled_data.applicant_2_dob_y1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_dob_y2" value="{{ prefilled_data.applicant_2_dob_y2|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_dob_y3" value="{{ prefilled_data.applicant_2_dob_y3|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_dob_y4" value="{{ prefilled_data.applicant_2_dob_y4|default:'' }}" />
                            </div>
                        </div>
                        <div class="inline">
                            <span>Date of Anniversary:</span>
                            <div class="char-grid ddmmyyyy">
                                <input class="char" maxlength="1" name="applicant_2_anniversary_d1" value="{{ prefilled_data.applicant_2_anniversary_d1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_anniversary_d2" value="{{ prefilled_data.applicant_2_anniversary_d2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_2_anniversary_m1" value="{{ prefilled_data.applicant_2_anniversary_m1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_anniversary_m2" value="{{ prefilled_data.applicant_2_anniversary_m2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_2_anniversary_y1" value="{{ prefilled_data.applicant_2_anniversary_y1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_anniversary_y2" value="{{ prefilled_data.applicant_2_anniversary_y2|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_anniversary_y3" value="{{ prefilled_data.applicant_2_anniversary_y3|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_anniversary_y4" value="{{ prefilled_data.applicant_2_anniversary_y4|default:'' }}" />
                            </div>
                        </div>
                    </div>
                    <div class="inline" style="margin-top: 6px">
                        <span>Marital Status:</span>
                        <div class="checks">
                            <label><input type="radio" name="applicant_2_marital_status" value="married" {% if prefilled_data.applicant_2_marital_status == 'married' %}checked{% endif %} /> Married</label>
                            <label><input type="radio" name="applicant_2_marital_status" value="unmarried" {% if prefilled_data.applicant_2_marital_status == 'unmarried' %}checked{% endif %} /> Unmarried</label>
                            <label><input type="radio" name="applicant_2_marital_status" value="other" {% if prefilled_data.applicant_2_marital_status == 'other' %}checked{% endif %} /> Other</label>
                        </div>
                    </div>

                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="inline">
                            <span>Pan No.:</span>
                            <div class="char-grid pan">
                                <input class="char" maxlength="1" name="applicant_2_pan_1" value="{{ prefilled_data.applicant_2_pan_1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_2" value="{{ prefilled_data.applicant_2_pan_2|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_3" value="{{ prefilled_data.applicant_2_pan_3|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_4" value="{{ prefilled_data.applicant_2_pan_4|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_5" value="{{ prefilled_data.applicant_2_pan_5|default:'' }}" />
                                <input class="char" maxlength="1" name="applicant_2_pan_6" value="{{ prefilled_data.applicant_2_pan_6|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_7" value="{{ prefilled_data.applicant_2_pan_7|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_8" value="{{ prefilled_data.applicant_2_pan_8|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_9" value="{{ prefilled_data.applicant_2_pan_9|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_pan_10" value="{{ prefilled_data.applicant_2_pan_10|default:'' }}" />
                            </div>
                        </div>
                        <div class="inline">
                            <span>Sex:</span>
                            <div class="checks">
                                <label><input type="radio" name="applicant_2_sex" value="male" {% if prefilled_data.applicant_2_sex == 'male' %}checked{% endif %} /> Male</label>
                                <label><input type="radio" name="applicant_2_sex" value="female" {% if prefilled_data.applicant_2_sex == 'female' %}checked{% endif %} /> Female</label>
                                <label><input type="radio" name="applicant_2_sex" value="others" {% if prefilled_data.applicant_2_sex == 'others' %}checked{% endif %} /> Others</label>
                            </div>
                        </div>
                    </div>
                    <div class="inline" style="margin-top: 6px">
                        <span>Aadhar Card No.:</span>
                        <div class="char-grid aadhaar">
                            <input class="char" maxlength="1" name="applicant_2_aadhar_1" value="{{ prefilled_data.applicant_2_aadhar_1|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_2" value="{{ prefilled_data.applicant_2_aadhar_2|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_3" value="{{ prefilled_data.applicant_2_aadhar_3|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_4" value="{{ prefilled_data.applicant_2_aadhar_4|default:'' }}" />
                            <input class="char" maxlength="1" name="applicant_2_aadhar_5" value="{{ prefilled_data.applicant_2_aadhar_5|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_6" value="{{ prefilled_data.applicant_2_aadhar_6|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_7" value="{{ prefilled_data.applicant_2_aadhar_7|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_8" value="{{ prefilled_data.applicant_2_aadhar_8|default:'' }}" />
                            <input class="char" maxlength="1" name="applicant_2_aadhar_9" value="{{ prefilled_data.applicant_2_aadhar_9|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_10" value="{{ prefilled_data.applicant_2_aadhar_10|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_11" value="{{ prefilled_data.applicant_2_aadhar_11|default:'' }}" /><input class="char" maxlength="1" name="applicant_2_aadhar_12" value="{{ prefilled_data.applicant_2_aadhar_12|default:'' }}" />
                        </div>
                    </div>

                    <div class="inline" style="margin-top: 6px">
                        <span>Residential Status:</span>
                        <div class="checks">
                            <label><input type="radio" name="applicant_2_residential_status" value="indian" {% if prefilled_data.applicant_2_residential_status == 'indian' %}checked{% endif %} /> Indian</label>
                            <label><input type="radio" name="applicant_2_residential_status" value="nri" {% if prefilled_data.applicant_2_residential_status == 'nri' %}checked{% endif %} /> NRI</label>
                            <label><input type="radio" name="applicant_2_residential_status" value="pio" {% if prefilled_data.applicant_2_residential_status == 'pio' %}checked{% endif %} /> PIO</label>
                            <label><input type="radio" name="applicant_2_residential_status" value="oci" {% if prefilled_data.applicant_2_residential_status == 'oci' %}checked{% endif %} /> OCI</label>
                        </div>
                    </div>

                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Residential Address:</div>
                        <textarea class="multiline" name="applicant_2_residential_address">{{ prefilled_data.applicant_2_residential_address|default:'' }}</textarea>
                    </div>

                    <div class="row cols-4" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">City:</div>
                            <input class="line" name="applicant_2_city" value="{{ prefilled_data.applicant_2_city|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Pin:</div>
                            <input class="line" name="applicant_2_pin" maxlength="6" value="{{ prefilled_data.applicant_2_pin|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">State:</div>
                            <input class="line" name="applicant_2_state" value="{{ prefilled_data.applicant_2_state|default:'Maharashtra' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Country:</div>
                            <input class="line" name="applicant_2_country" value="{{ prefilled_data.applicant_2_country|default:'India' }}" />
                        </div>
                    </div>

                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Correspondence Address:</div>
                        <textarea class="multiline" name="applicant_2_correspondence_address">{{ prefilled_data.applicant_2_correspondence_address|default:'' }}</textarea>
                    </div>
                    <div class="row cols-3" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">Contact No.: Residence:</div>
                            <input class="line" name="applicant_2_contact_residence" value="{{ prefilled_data.applicant_2_contact_residence|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Office:</div>
                            <input class="line" name="applicant_2_contact_office" value="{{ prefilled_data.applicant_2_contact_office|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Mobile:</div>
                            <input class="line" name="applicant_2_mobile" maxlength="10" value="{{ prefilled_data.applicant_2_mobile|default:'' }}" />
                        </div>
                    </div>
                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">E-mail id:</div>
                        <input class="line" name="applicant_2_email" value="{{ prefilled_data.applicant_2_email|default:'' }}" />
                    </div>
                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">Employment Type:</div>
                            <div class="checks">
                                <label><input type="radio" name="applicant_2_employment_type" value="salaried" {% if prefilled_data.applicant_2_employment_type == 'salaried' %}checked{% endif %} /> Salaried</label>
                                <label><input type="radio" name="applicant_2_employment_type" value="self_employed" {% if prefilled_data.applicant_2_employment_type == 'self_employed' %}checked{% endif %} /> Self Employed</label>
                            </div>
                        </div>
                        <div class="grid-fit">
                            <div class="label">Company Name:</div>
                            <input class="line" name="applicant_2_company_name" value="{{ prefilled_data.applicant_2_company_name|default:'' }}" />
                        </div>
                    </div>
                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Profession / Job Title:</div>
                        <input class="line" name="applicant_2_profession" value="{{ prefilled_data.applicant_2_profession|default:'' }}" />
                    </div>
                </div>
                
                <!-- Add Applicants button -->
                <div id="addBtn" class="add-btn hide-from-pdf">+ ADD APPLICANT</div>

                <!-- Applicant 3 -->
                <div id="app3" class="applicant-box" style="display: none; page-break-before: always;">
                    <div class="applicant-head">
                        <div class="section-head" style="margin: 0">
                            3<sup>rd</sup> APPLICANT DETAILS
                        </div>
                        <div class="note">
                            This section only comes if Add applicant is selected
                        </div>
                        <button type="button" class="remove-btn hide-from-pdf" onclick="removeApplicant('app3')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 11px; margin: 5px 0;">❌ Remove Applicant</button>
                    </div>
                    <div class="inline">
                        <span>Mr./Ms./Mrs.:</span><input class="line" style="min-width: 60px" name="applicant_3_title" value="{{ prefilled_data.applicant_3_title|default:'' }}" />
                        <span>First Name:</span><input class="line" style="min-width: 60px" name="applicant_3_first_name" value="{{ prefilled_data.applicant_3_first_name|default:'' }}" />
                        <span>Middle Name:</span><input class="line" style="min-width: 60px" name="applicant_3_middle_name" value="{{ prefilled_data.applicant_3_middle_name|default:'' }}" /> 
                        <span>Last Name:</span><input class="line" style="min-width: 60px" name="applicant_3_last_name" value="{{ prefilled_data.applicant_3_last_name|default:'' }}" />
                    </div>

                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="inline" style="align-items: center">
                            <span>Date of Birth:</span>
                            <div class="char-grid ddmmyyyy">
                                <input class="char" maxlength="1" name="applicant_3_dob_d1" value="{{ prefilled_data.applicant_3_dob_d1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_dob_d2" value="{{ prefilled_data.applicant_3_dob_d2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_3_dob_m1" value="{{ prefilled_data.applicant_3_dob_m1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_dob_m2" value="{{ prefilled_data.applicant_3_dob_m2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_3_dob_y1" value="{{ prefilled_data.applicant_3_dob_y1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_dob_y2" value="{{ prefilled_data.applicant_3_dob_y2|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_dob_y3" value="{{ prefilled_data.applicant_3_dob_y3|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_dob_y4" value="{{ prefilled_data.applicant_3_dob_y4|default:'' }}" />
                            </div>
                        </div>
                        <div class="inline">
                            <span>Date of Anniversary:</span>
                            <div class="char-grid ddmmyyyy">
                                <input class="char" maxlength="1" name="applicant_3_anniversary_d1" value="{{ prefilled_data.applicant_3_anniversary_d1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_anniversary_d2" value="{{ prefilled_data.applicant_3_anniversary_d2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_3_anniversary_m1" value="{{ prefilled_data.applicant_3_anniversary_m1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_anniversary_m2" value="{{ prefilled_data.applicant_3_anniversary_m2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_3_anniversary_y1" value="{{ prefilled_data.applicant_3_anniversary_y1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_anniversary_y2" value="{{ prefilled_data.applicant_3_anniversary_y2|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_anniversary_y3" value="{{ prefilled_data.applicant_3_anniversary_y3|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_anniversary_y4" value="{{ prefilled_data.applicant_3_anniversary_y4|default:'' }}" />
                            </div>
                        </div>
                    </div>
                    <div class="inline" style="margin-top: 6px">
                        <span>Marital Status:</span>
                        <div class="checks">
                            <label><input type="radio" name="applicant_3_marital_status" value="married" {% if prefilled_data.applicant_3_marital_status == 'married' %}checked{% endif %} /> Married</label>
                            <label><input type="radio" name="applicant_3_marital_status" value="unmarried" {% if prefilled_data.applicant_3_marital_status == 'unmarried' %}checked{% endif %} /> Unmarried</label>
                            <label><input type="radio" name="applicant_3_marital_status" value="other" {% if prefilled_data.applicant_3_marital_status == 'other' %}checked{% endif %} /> Other</label>
                        </div>
                    </div>

                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="inline">
                            <span>Pan No.:</span>
                            <div class="char-grid pan">
                                <input class="char" maxlength="1" name="applicant_3_pan_1" value="{{ prefilled_data.applicant_3_pan_1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_2" value="{{ prefilled_data.applicant_3_pan_2|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_3" value="{{ prefilled_data.applicant_3_pan_3|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_4" value="{{ prefilled_data.applicant_3_pan_4|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_5" value="{{ prefilled_data.applicant_3_pan_5|default:'' }}" />
                                <input class="char" maxlength="1" name="applicant_3_pan_6" value="{{ prefilled_data.applicant_3_pan_6|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_7" value="{{ prefilled_data.applicant_3_pan_7|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_8" value="{{ prefilled_data.applicant_3_pan_8|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_9" value="{{ prefilled_data.applicant_3_pan_9|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_pan_10" value="{{ prefilled_data.applicant_3_pan_10|default:'' }}" />
                            </div>
                        </div>
                        <div class="inline">
                            <span>Sex:</span>
                            <div class="checks">
                                <label><input type="radio" name="applicant_3_sex" value="male" {% if prefilled_data.applicant_3_sex == 'male' %}checked{% endif %} /> Male</label>
                                <label><input type="radio" name="applicant_3_sex" value="female" {% if prefilled_data.applicant_3_sex == 'female' %}checked{% endif %} /> Female</label>
                                <label><input type="radio" name="applicant_3_sex" value="others" {% if prefilled_data.applicant_3_sex == 'others' %}checked{% endif %} /> Others</label>
                            </div>
                        </div>
                    </div>
                    <div class="inline" style="margin-top: 6px">
                        <span>Aadhar Card No.:</span>
                        <div class="char-grid aadhaar">
                            <input class="char" maxlength="1" name="applicant_3_aadhar_1" value="{{ prefilled_data.applicant_3_aadhar_1|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_2" value="{{ prefilled_data.applicant_3_aadhar_2|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_3" value="{{ prefilled_data.applicant_3_aadhar_3|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_4" value="{{ prefilled_data.applicant_3_aadhar_4|default:'' }}" />
                            <input class="char" maxlength="1" name="applicant_3_aadhar_5" value="{{ prefilled_data.applicant_3_aadhar_5|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_6" value="{{ prefilled_data.applicant_3_aadhar_6|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_7" value="{{ prefilled_data.applicant_3_aadhar_7|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_8" value="{{ prefilled_data.applicant_3_aadhar_8|default:'' }}" />
                            <input class="char" maxlength="1" name="applicant_3_aadhar_9" value="{{ prefilled_data.applicant_3_aadhar_9|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_10" value="{{ prefilled_data.applicant_3_aadhar_10|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_11" value="{{ prefilled_data.applicant_3_aadhar_11|default:'' }}" /><input class="char" maxlength="1" name="applicant_3_aadhar_12" value="{{ prefilled_data.applicant_3_aadhar_12|default:'' }}" />
                        </div>
                    </div>

                    <div class="inline" style="margin-top: 6px">
                        <span>Residential Status:</span>
                        <div class="checks">
                            <label><input type="radio" name="applicant_3_residential_status" value="indian" {% if prefilled_data.applicant_3_residential_status == 'indian' %}checked{% endif %} /> Indian</label>
                            <label><input type="radio" name="applicant_3_residential_status" value="nri" {% if prefilled_data.applicant_3_residential_status == 'nri' %}checked{% endif %} /> NRI</label>
                            <label><input type="radio" name="applicant_3_residential_status" value="pio" {% if prefilled_data.applicant_3_residential_status == 'pio' %}checked{% endif %} /> PIO</label>
                            <label><input type="radio" name="applicant_3_residential_status" value="oci" {% if prefilled_data.applicant_3_residential_status == 'oci' %}checked{% endif %} /> OCI</label>
                        </div>
                    </div>

                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Residential Address:</div>
                        <textarea class="multiline" name="applicant_3_residential_address">{{ prefilled_data.applicant_3_residential_address|default:'' }}</textarea>
                    </div>

                    <div class="row cols-4" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">City:</div>
                            <input class="line" name="applicant_3_city" value="{{ prefilled_data.applicant_3_city|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Pin:</div>
                            <input class="line" name="applicant_3_pin" maxlength="6" value="{{ prefilled_data.applicant_3_pin|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">State:</div>
                            <input class="line" name="applicant_3_state" value="{{ prefilled_data.applicant_3_state|default:'Maharashtra' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Country:</div>
                            <input class="line" name="applicant_3_country" value="{{ prefilled_data.applicant_3_country|default:'India' }}" />
                        </div>
                    </div>

                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Correspondence Address:</div>
                        <textarea class="multiline" name="applicant_3_correspondence_address">{{ prefilled_data.applicant_3_correspondence_address|default:'' }}</textarea>
                    </div>
                    <div class="row cols-3" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">Contact No.: Residence:</div>
                            <input class="line" name="applicant_3_contact_residence" value="{{ prefilled_data.applicant_3_contact_residence|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Office:</div>
                            <input class="line" name="applicant_3_contact_office" value="{{ prefilled_data.applicant_3_contact_office|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Mobile:</div>
                            <input class="line" name="applicant_3_mobile" maxlength="10" value="{{ prefilled_data.applicant_3_mobile|default:'' }}" />
                        </div>
                    </div>
                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">E-mail id:</div>
                        <input class="line" name="applicant_3_email" value="{{ prefilled_data.applicant_3_email|default:'' }}" />
                    </div>
                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">Employment Type:</div>
                            <div class="checks">
                                <label><input type="radio" name="applicant_3_employment_type" value="salaried" {% if prefilled_data.applicant_3_employment_type == 'salaried' %}checked{% endif %} /> Salaried</label>
                                <label><input type="radio" name="applicant_3_employment_type" value="self_employed" {% if prefilled_data.applicant_3_employment_type == 'self_employed' %}checked{% endif %} /> Self Employed</label>
                            </div>
                        </div>
                        <div class="grid-fit">
                            <div class="label">Company Name:</div>
                            <input class="line" name="applicant_3_company_name" value="{{ prefilled_data.applicant_3_company_name|default:'' }}" />
                        </div>
                    </div>
                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Profession / Job Title:</div>
                        <input class="line" name="applicant_3_profession" value="{{ prefilled_data.applicant_3_profession|default:'' }}" />
                    </div>
                </div>
                
                <!-- Applicant 4 -->
                <div id="app4" class="applicant-box" style="display: none">
                    <div class="applicant-head">
                        <div class="section-head" style="margin: 0">
                            4<sup>th</sup> APPLICANT DETAILS
                        </div>
                        <div class="note">
                            This section only comes if Add applicant is selected
                        </div>
                        <button type="button" class="remove-btn hide-from-pdf" onclick="removeApplicant('app4')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 11px; margin: 5px 0;">❌ Remove Applicant</button>
                    </div>
                    <div class="inline">
                        <span>Mr./Ms./Mrs.:</span><input class="line" style="min-width: 60px" name="applicant_4_title" value="{{ prefilled_data.applicant_4_title|default:'' }}" />
                        <span>First Name:</span><input class="line" style="min-width: 60px" name="applicant_4_first_name" value="{{ prefilled_data.applicant_4_first_name|default:'' }}" />
                        <span>Middle Name:</span><input class="line" style="min-width: 60px" name="applicant_4_middle_name" value="{{ prefilled_data.applicant_4_middle_name|default:'' }}" /> 
                        <span>Last Name:</span><input class="line" style="min-width: 60px" name="applicant_4_last_name" value="{{ prefilled_data.applicant_4_last_name|default:'' }}" />
                    </div>

                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="inline" style="align-items: center">
                            <span>Date of Birth:</span>
                            <div class="char-grid ddmmyyyy">
                                <input class="char" maxlength="1" name="applicant_4_dob_d1" value="{{ prefilled_data.applicant_4_dob_d1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_dob_d2" value="{{ prefilled_data.applicant_4_dob_d2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_4_dob_m1" value="{{ prefilled_data.applicant_4_dob_m1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_dob_m2" value="{{ prefilled_data.applicant_4_dob_m2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_4_dob_y1" value="{{ prefilled_data.applicant_4_dob_y1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_dob_y2" value="{{ prefilled_data.applicant_4_dob_y2|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_dob_y3" value="{{ prefilled_data.applicant_4_dob_y3|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_dob_y4" value="{{ prefilled_data.applicant_4_dob_y4|default:'' }}" />
                            </div>
                        </div>
                        <div class="inline">
                            <span>Date of Anniversary:</span>
                            <div class="char-grid ddmmyyyy">
                                <input class="char" maxlength="1" name="applicant_4_anniversary_d1" value="{{ prefilled_data.applicant_4_anniversary_d1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_anniversary_d2" value="{{ prefilled_data.applicant_4_anniversary_d2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_4_anniversary_m1" value="{{ prefilled_data.applicant_4_anniversary_m1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_anniversary_m2" value="{{ prefilled_data.applicant_4_anniversary_m2|default:'' }}" />
                                <div class="divider">/</div>
                                <input class="char" maxlength="1" name="applicant_4_anniversary_y1" value="{{ prefilled_data.applicant_4_anniversary_y1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_anniversary_y2" value="{{ prefilled_data.applicant_4_anniversary_y2|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_anniversary_y3" value="{{ prefilled_data.applicant_4_anniversary_y3|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_anniversary_y4" value="{{ prefilled_data.applicant_4_anniversary_y4|default:'' }}" />
                            </div>
                        </div>
                    </div>
                    <div class="inline" style="margin-top: 6px">
                        <span>Marital Status:</span>
                        <div class="checks">
                            <label><input type="radio" name="applicant_4_marital_status" value="married" {% if prefilled_data.applicant_4_marital_status == 'married' %}checked{% endif %} /> Married</label>
                            <label><input type="radio" name="applicant_4_marital_status" value="unmarried" {% if prefilled_data.applicant_4_marital_status == 'unmarried' %}checked{% endif %} /> Unmarried</label>
                            <label><input type="radio" name="applicant_4_marital_status" value="other" {% if prefilled_data.applicant_4_marital_status == 'other' %}checked{% endif %} /> Other</label>
                        </div>
                    </div>

                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="inline">
                            <span>Pan No.:</span>
                            <div class="char-grid pan">
                                <input class="char" maxlength="1" name="applicant_4_pan_1" value="{{ prefilled_data.applicant_4_pan_1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_2" value="{{ prefilled_data.applicant_4_pan_2|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_3" value="{{ prefilled_data.applicant_4_pan_3|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_4" value="{{ prefilled_data.applicant_4_pan_4|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_5" value="{{ prefilled_data.applicant_4_pan_5|default:'' }}" />
                                <input class="char" maxlength="1" name="applicant_4_pan_6" value="{{ prefilled_data.applicant_4_pan_6|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_7" value="{{ prefilled_data.applicant_4_pan_7|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_8" value="{{ prefilled_data.applicant_4_pan_8|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_9" value="{{ prefilled_data.applicant_4_pan_9|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_pan_10" value="{{ prefilled_data.applicant_4_pan_10|default:'' }}" />
                            </div>
                        </div>
                        <div class="inline">
                            <span>Sex:</span>
                            <div class="checks">
                                <label><input type="radio" name="applicant_4_sex" value="male" {% if prefilled_data.applicant_4_sex == 'male' %}checked{% endif %} /> Male</label>
                                <label><input type="radio" name="applicant_4_sex" value="female" {% if prefilled_data.applicant_4_sex == 'female' %}checked{% endif %} /> Female</label>
                                <label><input type="radio" name="applicant_4_sex" value="others" {% if prefilled_data.applicant_4_sex == 'others' %}checked{% endif %} /> Others</label>
                            </div>
                        </div>
                    </div>
                    <div class="inline" style="margin-top: 6px">
                        <span>Aadhar Card No.:</span>
                        <div class="char-grid aadhaar">
                            <input class="char" maxlength="1" name="applicant_4_aadhar_1" value="{{ prefilled_data.applicant_4_aadhar_1|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_2" value="{{ prefilled_data.applicant_4_aadhar_2|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_3" value="{{ prefilled_data.applicant_4_aadhar_3|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_4" value="{{ prefilled_data.applicant_4_aadhar_4|default:'' }}" />
                            <input class="char" maxlength="1" name="applicant_4_aadhar_5" value="{{ prefilled_data.applicant_4_aadhar_5|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_6" value="{{ prefilled_data.applicant_4_aadhar_6|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_7" value="{{ prefilled_data.applicant_4_aadhar_7|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_8" value="{{ prefilled_data.applicant_4_aadhar_8|default:'' }}" />
                            <input class="char" maxlength="1" name="applicant_4_aadhar_9" value="{{ prefilled_data.applicant_4_aadhar_9|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_10" value="{{ prefilled_data.applicant_4_aadhar_10|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_11" value="{{ prefilled_data.applicant_4_aadhar_11|default:'' }}" /><input class="char" maxlength="1" name="applicant_4_aadhar_12" value="{{ prefilled_data.applicant_4_aadhar_12|default:'' }}" />
                        </div>
                    </div>

                    <div class="inline" style="margin-top: 6px">
                        <span>Residential Status:</span>
                        <div class="checks">
                            <label><input type="radio" name="applicant_4_residential_status" value="indian" {% if prefilled_data.applicant_4_residential_status == 'indian' %}checked{% endif %} /> Indian</label>
                            <label><input type="radio" name="applicant_4_residential_status" value="nri" {% if prefilled_data.applicant_4_residential_status == 'nri' %}checked{% endif %} /> NRI</label>
                            <label><input type="radio" name="applicant_4_residential_status" value="pio" {% if prefilled_data.applicant_4_residential_status == 'pio' %}checked{% endif %} /> PIO</label>
                            <label><input type="radio" name="applicant_4_residential_status" value="oci" {% if prefilled_data.applicant_4_residential_status == 'oci' %}checked{% endif %} /> OCI</label>
                        </div>
                    </div>

                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Residential Address:</div>
                        <textarea class="multiline" name="applicant_4_residential_address">{{ prefilled_data.applicant_4_residential_address|default:'' }}</textarea>
                    </div>

                    <div class="row cols-4" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">City:</div>
                            <input class="line" name="applicant_4_city" value="{{ prefilled_data.applicant_4_city|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Pin:</div>
                            <input class="line" name="applicant_4_pin" maxlength="6" value="{{ prefilled_data.applicant_4_pin|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">State:</div>
                            <input class="line" name="applicant_4_state" value="{{ prefilled_data.applicant_4_state|default:'Maharashtra' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Country:</div>
                            <input class="line" name="applicant_4_country" value="{{ prefilled_data.applicant_4_country|default:'India' }}" />
                        </div>
                    </div>

                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Correspondence Address:</div>
                        <textarea class="multiline" name="applicant_4_correspondence_address">{{ prefilled_data.applicant_4_correspondence_address|default:'' }}</textarea>
                    </div>
                    <div class="row cols-3" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">Contact No.: Residence:</div>
                            <input class="line" name="applicant_4_contact_residence" value="{{ prefilled_data.applicant_4_contact_residence|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Office:</div>
                            <input class="line" name="applicant_4_contact_office" value="{{ prefilled_data.applicant_4_contact_office|default:'' }}" />
                        </div>
                        <div class="grid-fit">
                            <div class="label">Mobile:</div>
                            <input class="line" name="applicant_4_mobile" maxlength="10" value="{{ prefilled_data.applicant_4_mobile|default:'' }}" />
                        </div>
                    </div>
                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">E-mail id:</div>
                        <input class="line" name="applicant_4_email" value="{{ prefilled_data.applicant_4_email|default:'' }}" />
                    </div>
                    <div class="row cols-2" style="margin-top: 6px">
                        <div class="grid-fit">
                            <div class="label">Employment Type:</div>
                            <div class="checks">
                                <label><input type="radio" name="applicant_4_employment_type" value="salaried" {% if prefilled_data.applicant_4_employment_type == 'salaried' %}checked{% endif %} /> Salaried</label>
                                <label><input type="radio" name="applicant_4_employment_type" value="self_employed" {% if prefilled_data.applicant_4_employment_type == 'self_employed' %}checked{% endif %} /> Self Employed</label>
                            </div>
                        </div>
                        <div class="grid-fit">
                            <div class="label">Company Name:</div>
                            <input class="line" name="applicant_4_company_name" value="{{ prefilled_data.applicant_4_company_name|default:'' }}" />
                        </div>
                    </div>
                    <div class="grid-fit" style="margin-top: 6px">
                        <div class="label">Profession / Job Title:</div>
                        <input class="line" name="applicant_4_profession" value="{{ prefilled_data.applicant_4_profession|default:'' }}" />
                    </div>
                </div>

                <!-- Channel Partner & Signatures -->
                <div class="section-head" style="margin-top: 16px; page-break-before: always;">
                    INCASE OF CHANNEL PARTNER
                </div>
                <div class="grid-fit">
                    <div class="label">Name of the Channel Partner:</div>
                    <input class="line" name="channel_partner_name" value="{% if channel_partner %}{{ prefilled_data.channel_partner_name|default:channel_partner.partner_name|default:'' }}{% else %}{{ prefilled_data.channel_partner_name|default:'' }}{% endif %}" />
                </div>
                <div class="grid-fit" style="margin-top: 6px">
                    <div class="label">Channel Partner MahaRERA Registration Number:</div>
                    <input class="line" name="channel_partner_rera" value="{% if channel_partner %}{{ prefilled_data.channel_partner_rera|default:channel_partner.rera_number|default:'' }}{% else %}{{ prefilled_data.channel_partner_rera|default:'' }}{% endif %}" />
                </div>
                <div class="row cols-2" style="margin-top: 6px">
                    <div class="grid-fit">
                        <div class="label">Mobile no.:</div>
                        <input class="line" name="channel_partner_mobile" maxlength="10" value="{% if channel_partner %}{{ prefilled_data.channel_partner_mobile|default:channel_partner.mobile_number|default:'' }}{% else %}{{ prefilled_data.channel_partner_mobile|default:'' }}{% endif %}" />
                    </div>
                    <div class="grid-fit">
                        <div class="label">E-mail ID:</div>
                        <input class="line" name="channel_partner_email" value="{{ prefilled_data.channel_partner_email|default:'' }}" />
                    </div>
                </div>
                <div class="grid-fit" style="margin-top: 10px">
                    <div class="label">Signature of Channel Partner:</div>
                    <span class="underline-holder"></span>
                </div>
                <div class="grid-fit" style="margin-top: 22px">
                    <div class="label">Customer Signature:</div>
                    <span class="underline-holder" style="max-width: 100px;"></span>
                </div>

                <!-- SOURCE OF BOOKING -->
                <div class="section-head">SOURCE OF BOOKING</div>
                <div class="row cols-2">
                    <label class="inline"><input type="checkbox" name="source_direct" {% if prefilled_data.source_direct %}checked{% endif %} /> Direct</label>
                    <div class="grid-fit">
                        <div class="label">Please Specify:</div>
                        <input class="line" name="source_direct_specify" value="{{ prefilled_data.source_direct_specify|default:'' }}" />
                    </div>
                </div>

                <!-- INCASE OF REFERRAL -->
                <div class="section-head">INCASE OF REFERRAL</div>
                <div class="row cols-21">
                    <div class="grid-fit">
                        <div class="label">Customer Name:</div>
                        <input class="line" name="referral_customer_name" value="{% if referral %}{{ prefilled_data.referral_customer_name|default:referral.referral_name|default:'' }}{% else %}{{ prefilled_data.referral_customer_name|default:'' }}{% endif %}" />
                    </div>
                    <div class="grid-fit-21">
                        <div class="label">Project:</div>
                        <input class="line" style="max-width: 180px" name="referral_project" value="{% if referral %}{{ prefilled_data.referral_project|default:referral.project_name|default:'' }}{% else %}{{ prefilled_data.referral_project|default:'' }}{% endif %}" />
                        <div class="label">Flat No.:</div>
                        <input class="line" style="max-width: 80px" name="referral_flat_no" value="{{ prefilled_data.referral_flat_no|default:'' }}" />
                    </div>
                </div>

                <!-- TERMS AND CONDITIONS -->
                <div class="section-head-term">TERMS AND CONDITIONS</div>
                <div class="terms">
                    <p>
                        1) The Applicant/s hereby request to be registered for provisional
                        allotment of a Residential Apartment/Flat (as mentioned in this
                        Booking Application Form) in the Project known as
                        <b>'{% if project_data %}{{ project_data.name }} situated at {{ project_data.site_name }}{% else %}Stardeous situated at Tardeo{% endif %}'</b>, to be developed by
                        <b>{% if project_data %}{{ project_data.company_name }}{% else %}Heston Builders Pvt. Ltd.{% endif %}</b> hereinafter referred to as "The
                        Promoter” 
                    </p>
                    <p>
                        2) The Applicant/s has/have clearly understood that this provisional
                        application for allotment and does not constitute a Letter of
                        Allotment or Agreement for Sale and that he/she/they do not become
                        entitled to the final allotment of the Residential Apartment
                        notwithstanding the fact that the Promoter may have issued a receipt
                        in acknowledgment of the monies received towards this provisional
                        application for allotment.
                    </p>
                    <p>
                        3) The Applicant/s has/have full knowledge of the rules, laws and
                        notification applicable to this area and in general, which have been
                        explained by the Promoter and understood by him/her/them.
                    </p>
                    <p>
                        4) The Applicant/s has/have satisfied himself/herself/themselves
                        about the interest and rights of the Promoter in the land on which
                        the said Project is being developed and understanding all
                        limitations and obligations in respect thereof. Hereafter no
                        complaint/objection on this account shall be entertained.
                    </p>
                    <p>
                        5) The Applicant/s agree that the Promoter shall have the right to
                        effect suitable change and necessary alterations in the layout plan,
                        if and when necessary, which may involve all or any of the changes,
                        namely change in location of the apartment, change in its number,
                        dimensions, height, size, area, layout or change of the entire
                        scheme as prescribed in RERA Act 2016 & MahaRERA Rules 2017.
                    </p>
                    <p>
                        6) The Applicant/s agree that the building plans and layout are
                        subject to changes and approval of the Municipal Corporation of
                        Greater Mumbai (MCGM) and any other authorities. The Promoter
                        reserves the right to make additions or amendments as may be
                        necessitated from time to time, as per RERA Act 2016 & MahaRERA
                        Rules 2017.
                    </p>
                    
                    <!-- Spacer for PDF top margin on page 2+ -->
                    <div style="height: 20px; width: 100%;"></div>
                    
                    <p>
                        7) Eligibility for Application: <br />
                        a) Any person competent to enter into contract under the Indian
                        Contract Act, 1881 shall be eligible. <br />
                        b) If Applicant/s is NRI, PIO, OCI, Non-resident, Foreign National
                        or Foreign Company, then the Applicant/s shall be solely responsible
                        for complying with the necessary compliance/permissions as per the
                        Foreign Exchange Management Act, Reserve Bank of India Act and any
                        other rule, regulations guidelines etc. <br />
                        c) The Applicant must have a Permanent Account Number (PAN) allowed
                        under the provision of Income Tax Act 1961 or Form 60 and the same
                        must be quoted on this Booking Application Form.
                    </p>
                </div>
    
                <!-- CUSTOMER SIGNATURE -->
                <div class="grid-fit" style="margin-top: 22px">
                    <div class="label">Customer Signature:</div>
                    <span class="underline-holder" style="max-width: 100px;"></span>
                </div>
    
                <div class="terms">
                    <p>
                        8) Application Procedure: <br />
                        a) A completed Booking Application Form shall be duly signed by
                        Applicant/s and submitted along with (i) self-attested address proof
                        (ii) PAN card of all Applicant/s and (iii) Cheque / Demand Draft/
                        Pay Order towards Application Money and taxes thereon as shown in
                        the Price Sheet and Payment Schedule annexed hereto as Annexure ‘A’.
                        <br />
                        b) On realization of the Application Money, the Promoter will issue
                        a Letter of Allotment detailing in brief the terms and conditions of
                        this transaction. In order to proceed with the purchase of the said
                        flat, the same will require to be accepted and duly signed by the
                        Applicant/s. <br />
                        c) On the realization of upto 10% of the Purchase Price by the
                        Promoter, the Applicant/s must execute and register the Agreement
                        for Sale in the Promoters standard format. The same shall be
                        completed within 60 days of this Booking Application Form. Kindly
                        note, forwarding this Booking Application Form to the Applicant/s by
                        the Promoter does not create any binding obligation on the part of
                        the Promoter.
                    </p>
    
                    <p>
                        9) Further the Applicants/ agree that the Stamp Duty, Registration
                        charges, and any other government taxes, duties and charges
                        applicable for execution of the Agreement for Sale will be borne and
                        paid by the Applicant/s. Further, any liabilities arising out of
                        Sales Tax/VAT/GST or any other taxes dues and charges with respect
                        to this transaction, shall be paid by the Applicant/s immediately on
                        demand by the Promoter or the concerned authorities.
                    </p>
    
                    <p>
                        10) The Applicant/s confirms that in addition to the Purchase Price,
                        he/she/they shall be liable to pay all government taxes, duties,
                        cesses etc. and Other Charges payable to the Promoter as are
                        detailed in Annexure ‘A’ herewith annexed.
                    </p>
    
                    <p style="page-break-before: always;">
                        11) It is specifically agreed and confirmed by the Applicant/s that
                        the timely payment of the installments is the essence of this
                        transaction. Incase of delay or non-payment of any of the
                        installments or any other amounts, interest at State Bank of India
                        highest Marginal Rate Plus 2% will be charged on all outstanding
                        payments from the due date to the date of full realization. The
                        Promoter shall not be responsible for any delay in payments
                        pertaining to delays caused by the Applicant’s Bank, NBFC, HFC, etc.
                        for sanctioning or disbursing the Applicant’s housing loan.
                    </p>
    
                    <p>
                        12) Incase of regular defaults and/or delayed payments, the Promoter
                        reserves the right to terminate this Booking Application by
                        providing 15 days notice. In case of termination, the Promoter shall
                        be entitled to forfeit the Application Money paid by the Applicant/s
                        at the time of this Booking Application.
                    </p>
    
                    <p>
                        13) In case the Applicant/s wishes to cancel this Booking
                        Application, an amount mentioned in the Table hereunder written
                        would be deducted and the balance amount due and payable shall be
                        refunded to you without interest within 45 (forty five) days from
                        the date of receipt of your letter requesting to cancel this Booking
                        Application.
                    </p>
    
                    <!-- Cancellation Table -->
                    <table border="1" cellspacing="0" cellpadding="6"
                        style="width: 100%; border-collapse: collapse; font: 600 11px Arial, sans-serif; margin: 8px 0">
                        <thead style="background: #f0f0f0">
                            <tr>
                                <th style="text-align: center">Sr No.</th>
                                <th>If the letter requesting to cancel the booking is received</th>
                                <th>Amount to be deducted</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="text-align: center">1.</td>
                                <td>Within 15 days from issuance of the allotment letter</td>
                                <td>Nil</td>
                            </tr>
                            <tr>
                                <td style="text-align: center">2.</td>
                                <td>
                                    Within 16 to 30 days from issuance of the allotment letter
                                </td>
                                <td>1% of the purchase price of the said flat</td>
                            </tr>
                            <tr>
                                <td style="text-align: center">3.</td>
                                <td>
                                    Within 31 to 60 days from issuance of the allotment letter
                                </td>
                                <td>1.5% of the purchase price of the said flat</td>
                            </tr>
                            <tr>
                                <td style="text-align: center">4.</td>
                                <td>After 61 days from issuance of the allotment letter</td>
                                <td>2% of the purchase price of the said flat</td>
                            </tr>
                            <tr>
                                <td style="text-align: center">5.</td>
                                <td>
                                    After 91<sup>st</sup> day from issuance of the allotment
                                    letter
                                </td>
                                <td>5% of the purchase price of the said flat</td>
                            </tr>
                        </tbody>
                    </table>
    
                    <p>
                        14) The Applicant/s shall not be entitled to get the name
                        swapped/changed/deleted/substituted of the nominee in his/her/their
                        place without the prior written approval of the Promoter.
                    </p>
    
                    <p>
                        15) The Promoter reserves the right for creation of charge, security,
                        encumbrances, securitization or other arrangements, at its sole
                        discretion, in respect of the project, structure and building being
                        developed and/or amount receivable from the Applicant/s, in relation
                        to the borrowing, credit facility or finance avails by the Promoter.
                        The Applicant/s hereby accords his/her/their irrevocable consent for
                        the aforesaid.
                    </p>
                </div>
    
                <!-- CUSTOMER SIGNATURE -->
                <div class="grid-fit" style="margin-top: 22px">
                    <div class="label">Customer Signature:</div>
                    <span class="underline-holder" style="max-width: 100px;"></span>
                </div>
    
                <div class="terms">
                    <p>
                        16) The Applicant/s confirm that he/she/they will not be permitted
                        to transfer/sell the apartment until all the outstanding dues
                        payable by the Applicant/s to the Promoter are fully paid up.
                    </p>
    
                    <p>
                        17) The Applicant/s agree and confirm that all correspondence will
                        be made with the first applicant at the address for correspondence
                        on the Promoter’s record (indicated in this Booking Application
                        Form). Any change in the Address/Email id/Contact no: will have to
                        be notified in writing to the Promoter at its Corporate Office and
                        acknowledgement obtained for such change, failing which all demand
                        letters and notice posted to the original correspondence address
                        will be deemed to have been served and the Applicant/s shall be
                        responsible for default in payment and other consequences that might
                        occur.
                    </p>
    
                    <p>
                        19) The Applicant/s shall from time to time sign all applications,
                        paper, documents, maintenance agreement, electricity agreement and
                        other relevant papers, as required, and to do all acts, deeds and
                        things as the Promoter may require in the interest of the complex
                        and Apartment/Flat owners. In case of joint Applicant/s, any
                        document signed/accepted/acknowledgement by any one of the Applicant
                        shall be binding upon the other Applicant/s.
                    </p>
    
                    <p>
                        20) The Applicant/s confirm/s that he/she does not have any
                        objection for the Promoter sending communication via telephone or
                        e-mail regarding its upcoming projects and related offers.
                    </p>
    
                    <p style="page-break-before: always;">
                        I/We have fully read, understood and agree to abide by the above
                        mentioned terms and conditions stipulated by
                        <b>{% if project_data %}{{ project_data.company_name }}{% else %}Heston Builders Private Ltd.{% endif %}</b> <span style="color: red"></span>
                    </p>
    
                    <p>


                    
                    <!-- Payment Table -->
                    <table border="1" cellspacing="0" cellpadding="6" style="width: 100%; border-collapse: collapse; font: 600 11px Arial, sans-serif; margin: 8px 0">
                        <thead style="background: #f0f0f0">
                            <tr>
                                <th></th>
                                <th style="text-align: center">Towards 'Application Money'</th>
                                <th style="text-align: center">Towards 'GST'</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Favouring</td>
                                <td style="color: red; font-weight: bold">
                                    Auto filled as per selected Project
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Amount</td>
                                <td><input type="number" name="application_money_amount" step="0.01" value="{{ prefilled_data.application_money_amount|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                                <td><input type="number" name="gst_amount" step="0.01" value="{{ prefilled_data.gst_amount|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                            </tr>
                            <tr>
                                <td>Amount (In Words)</td>
                                <td><input type="text" name="application_money_words" value="{{ prefilled_data.application_money_words|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                                <td><input type="text" name="gst_words" value="{{ prefilled_data.gst_words|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                            </tr>
                            <tr>
                                <td>Cheque/ Demand Draft No.</td>
                                <td><input type="text" name="cheque_dd_no" value="{{ prefilled_data.cheque_dd_no|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                                <td><input type="text" name="gst_cheque_dd_no" value="{{ prefilled_data.gst_cheque_dd_no|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                            </tr>
                            <tr>
                                <td>Date of Instrument</td>
                                <td><input type="date" name="instrument_date" value="{% if prefilled_data.instrument_date %}{{ prefilled_data.instrument_date|date:'Y-m-d' }}{% endif %}" style="width: 100%; border: none; padding: 2px;"></td>
                                <td><input type="date" name="gst_instrument_date" value="{% if prefilled_data.gst_instrument_date %}{{ prefilled_data.gst_instrument_date|date:'Y-m-d' }}{% endif %}" style="width: 100%; border: none; padding: 2px;"></td>
                            </tr>
                            <tr>
                                <td>Drawn On</td>
                                <td><input type="text" name="drawn_on" value="{{ prefilled_data.drawn_on|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                                <td><input type="text" name="gst_drawn_on" value="{{ prefilled_data.gst_drawn_on|default:'' }}" style="width: 100%; border: none; padding: 2px;"></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <p style="font-size: 11px; text-align: justify">
                        Kindly note: As per provisions of Sec. 194 IA of the Income Tax Act
                        1961, TDS @ 1% (one percent) should be deducted by the Applicant at
                        the time of making payment of the Application Money. TDS deducted
                        should be deposited to the Government Account through any of the
                        authorized bank branches. Kindly submit original acknowledged copy
                        of form 16B immediately on payment of TDS or before the end of the
                        month in which the tax is deductible.
                    </p>
                </div>

                <!-- CUSTOMER SIGNATURE -->
                <div class="grid-fit" style="margin-top: 22px">
                    <div class="label">Customer Signature:</div>
                    <span class="underline-holder" style="max-width: 100px;"></span>
                </div>

                <!-- SIGNATURES SECTION -->
                <div style="margin-top: 40px; font: 600 12px Arial, sans-serif; line-height: 1.6;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 50px;">
                        <div style="text-align: center;">
                            _________________________<br />Signature of 1st Applicant
                        </div>
                        <div style="text-align: center;">
                            _________________________<br />Signature of 2nd Applicant
                        </div>
                        <div style="text-align: center;">
                            _________________________<br />Signature of 3rd Applicant
                        </div>
                    </div>

                    <div class="fourth-app" style="text-align: center; margin-bottom: 60px;">
                        _________________________<br />Signature of 4th Applicant
                    </div>

                    <p style="margin: 10px 0;">I confirm,</p>
                    <p style="margin: 10px 0;">For</p>

                    <div style="display: flex; justify-content: space-between; margin: 50px 0 30px;">
                        <div style="text-align: center;">
                            _________________________<br />Signature of Sales Manager
                        </div>
                        <div style="text-align: center;">
                            _________________________<br />Signature of Sourcing Manager
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-bottom: 40px;">
                        <div>Name of Sales Manager: <input class="line" name="sales_manager_name" value="{{ prefilled_data.sales_manager_name|default:customer.sales_assessment.sales_manager|default:'' }}" style="min-width: 200px;" /></div>
                        <div>Name of Sourcing Manager: <input class="line" name="sourcing_manager_name" value="{{ prefilled_data.sourcing_manager_name|default:customer.sales_assessment.sourcing_manager|default:'' }}" style="min-width: 200px;" /></div>
                    </div>
                </div>

                <!-- REGISTERED OFFICE INFO -->
                <div style="border: 1px solid #e21c22; padding: 10px 14px; margin: 40px 0 30px; font: 600 11px/1.6 Arial, sans-serif; text-align: justify;">
                    Registered Office: {% if project_data %}{{ project_data.company_name }}{% else %}Heston Builders Private Ltd.{% endif %} 463, Sant Veer Meghmaya
                    Road, Bhatt Chawl, Bane Compound, Tardeo, Mumbai- 400034.
                    <span style="color: red; font-weight: bold">As per selected Project</span><br />
                    MahaRERA Registration Number: {% if project_data %}{{ project_data.maharera_no }}{% else %}P51900053358{% endif %} , Available at website:
                    <a href="http://maharera.mahaonline.gov.in" target="_blank">http://maharera.mahaonline.gov.in</a><br />
                    Disclaimer: The company reserves the right to make modifications,
                    changes or alterations at their sole discretion without any prior
                    notice or reference.
                </div>

                <!-- CUSTOMER SIGNATURE -->
                <div class="grid-fit" style="margin: 40px 0;">
                    <div class="label">Customer Signature:</div>
                    <span class="underline-holder" style="max-width: 100px;"></span>
                </div>
                <!-- REGISTERED OFFICE INFORMATION WITH QR CODE -->
                <div class="footer-with-QR" style="display: flex; justify-content: space-between; align-items: flex-start; margin: 40px 0; padding: 20px; border: 2px solid #e21c22; background-color: #f9f9f9; gap: 20px;">
                    <div style="flex: 1; font: 11px/1.6 Arial, sans-serif; color: #333; text-align: justify;">
                        <p style="margin: 0 0 10px 0;">
                            <strong>Registered Office:</strong> {% if project_data %}{{ project_data.company_name }}{% else %}Heston Builders Private Ltd.{% endif %} 463, Sant Veer Meghmaya Road, Bhatt Chawl, Bane Compound, Tardeo, Mumbai- 400034. As per selected Project
                        </p>
                        <p style="margin: 0 0 10px 0;">
                            <strong>MahaRERA Registration Number:</strong> {% if project_data %}{{ project_data.maharera_no }}{% else %}P51900053358{% endif %}, Available at website: <span style="color: #e21c22;">http://maharera.mahaonline.gov.in</span>
                        </p>
                        <p style="margin: 0; font-style: italic; color: #666;">
                            <strong>Disclaimer:</strong> The company reserves the right to make modifications, changes or alterations at their sole discretion without any prior notice or reference.
                        </p>
                    </div>
                    <div style="flex-shrink: 0; text-align: center;">
                        <div style="font: bold 12px Arial, sans-serif; color: #e21c22; margin-bottom: 8px;">
                            📱 QR CODE
                        </div>
                        <!-- QR Code placeholder - replace with actual QR code generation -->
                        <div style="width: 100px; height: 100px; border: 2px dashed #e21c22; display: flex; align-items: center; justify-content: center; font: 10px Arial, sans-serif; text-align: center; color: #e21c22; background: white;">
                            QR<br>{{ customer.id }}
                        </div>
                        <div style="font: 9px Arial, sans-serif; color: #666; margin-top: 5px; text-align: center;">
                            Scan for<br>quick access
                        </div>
                    </div>
                </div>



                <!-- Submit Buttons -->
                <div class="hide-from-pdf" style="display: flex; gap: 20px; justify-content: center; margin: 30px 0;">
                    <button type="submit" style="background: var(--gold); color: var(--ink); padding: 15px 30px; border: 2px solid var(--ink); border-radius: 8px; font: 700 14px Arial, sans-serif; cursor: pointer; transition: all 0.3s ease;" id="submitFormBtn">
                        {% if existing_booking %}
                            💾 UPDATE BOOKING APPLICATION
                        {% else %}
                            💾 SUBMIT BOOKING APPLICATION
                        {% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Form validation functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Number-only fields validation
            const numberOnlyFields = [
                'flat_number',
                'floor',
                'exclusive_deck_balcony',
                'car_parking_count',
                'total_purchase_price',
                'applicant_1_mobile',
                'applicant_2_mobile',
                'applicant_3_mobile',
                'applicant_4_mobile',
                'channel_partner_mobile'
            ];

            // Add validation for number-only fields
            numberOnlyFields.forEach(fieldName => {
                const field = document.querySelector(`[name="${fieldName}"]`);
                if (field) {
                    field.addEventListener('input', function(e) {
                        // Remove any non-numeric characters (except decimal point for price fields)
                        if (fieldName === 'exclusive_deck_balcony' || fieldName === 'total_purchase_price') {
                            this.value = this.value.replace(/[^0-9.]/g, '');
                            // Ensure only one decimal point
                            const parts = this.value.split('.');
                            if (parts.length > 2) {
                                this.value = parts[0] + '.' + parts.slice(1).join('');
                            }
                        } else {
                            this.value = this.value.replace(/[^0-9]/g, '');
                        }
                    });
                    
                    field.addEventListener('keypress', function(e) {
                        // Allow decimal point only for certain fields
                        if (fieldName === 'exclusive_deck_balcony' || fieldName === 'total_purchase_price') {
                            if (!/[0-9.]/.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(e.key)) {
                                e.preventDefault();
                            }
                        } else {
                            // Only allow numbers for other fields
                            if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(e.key)) {
                                e.preventDefault();
                            }
                        }
                    });
                }
            });

            // Aadhaar number validation - only numbers
            const aadhaarFields = document.querySelectorAll('input[name*="aadhar"]');
            aadhaarFields.forEach(field => {
                field.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
                
                field.addEventListener('keypress', function(e) {
                    if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab'].includes(e.key)) {
                        e.preventDefault();
                    }
                });
            });

            // Text-only fields validation
            const textOnlyFields = [
                'applicant_1_title',
                'applicant_1_first_name',
                'applicant_1_middle_name',
                'applicant_1_last_name',
                'applicant_2_title',
                'applicant_2_first_name',
                'applicant_2_middle_name',
                'applicant_2_last_name',
                'applicant_3_title',
                'applicant_3_first_name',
                'applicant_3_middle_name',
                'applicant_3_last_name',
                'applicant_4_title',
                'applicant_4_first_name',
                'applicant_4_middle_name',
                'applicant_4_last_name',
                'applicant_1_city',
                'applicant_1_state',
                'applicant_2_city',
                'applicant_2_state',
                'applicant_3_city',
                'applicant_3_state',
                'applicant_4_city',
                'applicant_4_state',
                'channel_partner_name'
            ];

            // Add validation for text-only fields
            textOnlyFields.forEach(fieldName => {
                const field = document.querySelector(`[name="${fieldName}"]`);
                if (field) {
                    field.addEventListener('input', function(e) {
                        // Remove any numbers
                        this.value = this.value.replace(/[0-9]/g, '');
                    });
                    
                    field.addEventListener('keypress', function(e) {
                        // Prevent numbers from being typed
                        if (/[0-9]/.test(e.key)) {
                            e.preventDefault();
                        }
                    });
                }
            });

            // Hide/Show Date of Anniversary based on Marital Status
            function toggleAnniversaryFields() {
                const applicants = ['applicant_1', 'applicant_2', 'applicant_3', 'applicant_4'];
                
                applicants.forEach(applicant => {
                    const marriedRadio = document.querySelector(`input[name="${applicant}_marital_status"][value="married"]`);
                    const unmarriedRadio = document.querySelector(`input[name="${applicant}_marital_status"][value="unmarried"]`);
                    const otherRadio = document.querySelector(`input[name="${applicant}_marital_status"][value="other"]`);
                    
                    // Find the anniversary fields container for this applicant
                    const anniversaryContainer = document.querySelector(`input[name="${applicant}_anniversary_d1"]`)?.closest('.inline');
                    
                    if (marriedRadio && unmarriedRadio && anniversaryContainer) {
                        function updateAnniversaryVisibility() {
                            if (unmarriedRadio.checked) {
                                anniversaryContainer.style.display = 'none';
                                // Clear anniversary fields when hidden
                                const anniversaryFields = anniversaryContainer.querySelectorAll('input[name*="anniversary"]');
                                anniversaryFields.forEach(field => field.value = '');
                            } else {
                                anniversaryContainer.style.display = 'flex';
                            }
                        }
                        
                        marriedRadio.addEventListener('change', updateAnniversaryVisibility);
                        unmarriedRadio.addEventListener('change', updateAnniversaryVisibility);
                        if (otherRadio) otherRadio.addEventListener('change', updateAnniversaryVisibility);
                        
                        // Initial check
                        updateAnniversaryVisibility();
                    }
                });
            }

            // Initialize anniversary field visibility
            toggleAnniversaryFields();

            // Auto-fetch project name from existing data
            const projectNameField = document.getElementById('projectName');
            if (projectNameField) {
                // Check if there's existing project data to fetch
                {% if customer.project_name %}
                    projectNameField.value = '{{ customer.project_name }}';
                {% elif prefilled_data.project_name %}
                    // Keep the prefilled value if it exists and isn't the default
                {% else %}
                    // You can add more logic here to fetch project names from other sources
                    // For now, we'll keep the existing default behavior
                {% endif %}
            }
        });

        // Character grid auto-navigation functionality
        (function() {
            const chars = document.querySelectorAll(".char");
            chars.forEach((box, idx) => {
                // Auto-move to next character on input
                box.addEventListener("input", (e) => {
                    // Only allow single character
                    if (e.target.value.length > 1) {
                        e.target.value = e.target.value.slice(0, 1);
                    }
                    
                    // Auto-focus next box
                    if (e.target.value.length === 1) {
                        const next = chars[idx + 1];
                        if (next && next.classList.contains("char")) {
                            next.focus();
                        }
                    }
                });
                
                // Handle backspace navigation
                box.addEventListener("keydown", (e) => {
                    if (e.key === "Backspace") {
                        if (!e.target.value) {
                            const prev = chars[idx - 1];
                            if (prev && prev.classList.contains("char")) {
                                prev.focus();
                            }
                        }
                    }
                    
                    // Allow arrow key navigation
                    if (e.key === "ArrowRight") {
                        const next = chars[idx + 1];
                        if (next && next.classList.contains("char")) {
                            next.focus();
                        }
                    }
                    
                    if (e.key === "ArrowLeft") {
                        const prev = chars[idx - 1];
                        if (prev && prev.classList.contains("char")) {
                            prev.focus();
                        }
                    }
                });
                
                // Auto-select all content on focus for easy editing
                box.addEventListener("focus", (e) => {
                    if (e.target.value) {
                        e.target.select();
                    }
                });
            });
        })();
        
        // Add applicant functionality
        (function() {
            const sections = [
                document.getElementById("app2"),
                document.getElementById("app3"),
                document.getElementById("app4"),
            ];
            const addBtn = document.getElementById("addBtn");
            let shown = 1; // Start with 1 - 1st and 2nd applicants visible by default
            
            console.log('Applicant sections found:', sections.length);
            console.log('Add button found:', addBtn !== null);
            
            // Function to move Add button after the last visible applicant
            function moveAddButton() {
                if (!addBtn) return;
                
                const lastVisibleSection = getLastVisibleApplicantSection();
                if (lastVisibleSection && lastVisibleSection.parentNode) {
                    // Insert after the last visible applicant
                    lastVisibleSection.parentNode.insertBefore(addBtn, lastVisibleSection.nextSibling);
                }
            }
            
            // Function to get the last visible applicant section
            function getLastVisibleApplicantSection() {
                // Start with 1st applicant section (always visible)
                let lastVisible = document.querySelector('.applicant-box').parentNode.children[0];
                
                // Check app2, app3, app4
                sections.forEach(section => {
                    if (section && section.style.display !== 'none') {
                        lastVisible = section;
                    }
                });
                
                return lastVisible;
            }
            
            // Function to remove applicant
            window.removeApplicant = function(appId) {
                const section = document.getElementById(appId);
                if (!section) return;
                
                console.log(`Removing applicant: ${appId}`);
                section.style.display = 'none';
                
                // Clear all inputs in the section
                const inputs = section.querySelectorAll('input, textarea, select');
                inputs.forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
                
                // Update shown counter
                const appNumber = parseInt(appId.replace('app', ''));
                if (appNumber >= 2 && appNumber <= 4) {
                    const sectionIndex = appNumber - 2; // app2=0, app3=1, app4=2
                    if (shown > sectionIndex) {
                        shown = Math.max(0, shown - 1);
                    }
                }
                
                // Show add button if it was hidden
                if (addBtn) {
                    addBtn.style.display = 'block';
                    moveAddButton();
                }
                
                console.log(`Removed ${appId}, shown count: ${shown}`);
            };
            
            // Show existing applicants on page load (for editing existing bookings)
            {% if existing_applicants %}
                const existingApplicants = {{ existing_applicants|safe }};
                console.log('Showing existing applicants:', existingApplicants);
                
                // Show all existing applicant sections automatically
                existingApplicants.forEach(function(applicantNumber) {
                    console.log('Processing applicant number:', applicantNumber);
                    if (applicantNumber >= 2 && applicantNumber <= 4) {
                        const sectionIndex = applicantNumber - 2; // app2=0, app3=1, app4=2
                        if (sections[sectionIndex]) {
                            console.log('Showing applicant section:', applicantNumber, 'at index:', sectionIndex);
                            sections[sectionIndex].style.display = "block";
                            shown = Math.max(shown, sectionIndex + 1);
                        }
                    }
                });
                
                // Update add button position and visibility
                if (addBtn) {
                    if (shown >= sections.length) {
                        // All sections shown, hide add button
                        addBtn.style.display = "none";
                    } else {
                        // Show add button after existing applicants
                        addBtn.style.display = "block";
                        
                        // Move add button after the last shown applicant
                        const lastShownSection = sections[shown - 1] || sections[0];
                        if (lastShownSection && lastShownSection.parentNode) {
                            // Insert add button after last shown applicant section
                            lastShownSection.parentNode.insertBefore(addBtn, lastShownSection.nextSibling);
                        }
                    }
                }
                
            {% else %}
                // No existing applicants, add button stays in original position
                console.log('No existing applicants found');
            {% endif %}
            
            // Initial positioning of add button
            moveAddButton();
            
            if (addBtn) {
                addBtn.addEventListener("click", () => {
                    console.log('Add button clicked. Current shown:', shown, 'Total sections:', sections.length);
                    if (shown < sections.length) {
                        const currentSection = sections[shown];
                        console.log('Showing section:', currentSection.id);
                        currentSection.style.display = "block";
                        shown += 1;
                        console.log('Updated shown count:', shown);
                        
                        if (shown === sections.length) {
                            console.log('All sections shown, hiding add button');
                            addBtn.style.display = "none";
                        } else {
                            // Move add button after the newly shown section
                            moveAddButton();
                        }
                        
                        // Smooth scroll to the newly shown section
                        currentSection.scrollIntoView({
                            behavior: "smooth",
                            block: "start",
                        });
                    } else {
                        console.log('All sections already visible');
                    }
                });
            }
        })();

        // Form submission handler
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            handleFormSubmission('submit');
        });


        // Form submission handler
        function handleFormSubmission(action) {
            const submitBtn = document.getElementById('submitFormBtn');
            const isUpdate = submitBtn.innerHTML.includes('UPDATE');
            
            // Store original text
            const submitOriginalText = submitBtn.innerHTML;
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '⏳ Processing...';
            
            // Get form data
            const formData = new FormData(document.getElementById('bookingForm'));
            
            console.log('Submitting form data...'); // Debug log
            
            // Submit to Django backend
            fetch(window.location.href, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                }
            })
            .then(response => {
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return response.json();
            })
            .then(data => {
                console.log('Response received');
                
                // Handle form submission response
                if (data.success) {
                    const actionText = isUpdate ? 'updated' : 'submitted';
                    alert(`✅ Booking application ${actionText} successfully!`);
                    if (data.redirect_url) {
                        window.location.href = data.redirect_url;
                    }
                } else {
                    alert('❌ Error: ' + (data.error || 'Something went wrong'));
                }
            })
            .catch(error => {
                console.error('Error details:', error);
                alert('🚫 Network error: ' + error.message + '\n\nPlease check your connection and try again.');
            })
            .finally(() => {
                // Re-enable button and restore text
                submitBtn.disabled = false;
                submitBtn.innerHTML = submitOriginalText;
            });
        }

        // Format form number to uppercase property code
        document.addEventListener('DOMContentLoaded', function() {
            const formNumberEl = document.getElementById('formNumber');
            if (formNumberEl) {
                let formNumber = formNumberEl.textContent.trim();
                // Convert property code part to uppercase
                if (formNumber.includes('-')) {
                    const parts = formNumber.split('-');
                    parts[0] = parts[0].toUpperCase();
                    formNumberEl.textContent = parts.join('-');
                }
            }
        });

        // PDF Download Functionality - Simplified and Fixed
        document.getElementById('downloadPdfBtn').addEventListener('click', function() {
            const button = this;
            button.innerHTML = '⏳ Generating PDF...';
            button.disabled = true;
            
            console.log('=== PDF Generation Debug Info ===');
            console.log('html2pdf available:', typeof html2pdf !== 'undefined');
            
            // Get the target element for PDF generation
            const targetElement = document.querySelector('.frame');
            console.log('Target element (.frame):', !!targetElement);
            
            if (targetElement) {
                console.log('Element dimensions:', targetElement.offsetWidth + 'x' + targetElement.offsetHeight);
                console.log('Element display style:', getComputedStyle(targetElement).display);
                console.log('Element visibility:', getComputedStyle(targetElement).visibility);
                console.log('Content preview:', targetElement.innerHTML.substring(0, 200) + '...');
            } else {
                console.error('Target element not found!');
                button.innerHTML = '❌ Element Not Found';
                setTimeout(() => { button.innerHTML = '📄 Download PDF'; button.disabled = false; }, 3000);
                return;
            }
            
            // Store original state of applicant sections
            const app2 = document.getElementById('app2');
            const app3 = document.getElementById('app3');
            const app4 = document.getElementById('app4');
            
            const originalApp2Display = app2 ? app2.style.display : '';
            const originalApp3Display = app3 ? app3.style.display : '';
            const originalApp4Display = app4 ? app4.style.display : '';
            
            // Show all applicants in PDF
            if (app2) app2.style.display = 'block';
            if (app3) app3.style.display = 'block';
            if (app4) app4.style.display = 'block';
            
            // Hide elements from PDF
            const downloadBtn = document.getElementById('downloadPdfBtn');
            const originalBtnDisplay = downloadBtn.style.display;
            downloadBtn.style.display = 'none';
            
            // Hide all elements with 'hide-from-pdf' class
            const elementsToHide = document.querySelectorAll('.hide-from-pdf');
            const originalDisplays = [];
            elementsToHide.forEach((element, index) => {
                originalDisplays[index] = element.style.display;
                element.style.display = 'none';
            });
            
            // PDF configuration - using perfect settings from working code
            const opt = {
                margin: 0.3,
                filename: 'booking-form.pdf',
                image: { type: 'jpeg', quality: 1.0 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'a3', orientation: 'portrait' }
            };
            
            console.log('Starting PDF generation...');
            
            // Use the simpler API
            html2pdf().set(opt).from(targetElement).save().then(() => {
                console.log('PDF generation completed successfully');
            }).catch((error) => {
                console.error('PDF generation failed:', error);
                button.innerHTML = '❌ PDF Failed';
                setTimeout(() => { button.innerHTML = '📄 Download PDF'; }, 3000);
            }).finally(() => {
                
                // Restore original applicant section displays
                if (app2) app2.style.display = originalApp2Display;
                if (app3) app3.style.display = originalApp3Display;
                if (app4) app4.style.display = originalApp4Display;
                
                // Restore all hidden elements
                downloadBtn.style.display = originalBtnDisplay;
                elementsToHide.forEach((element, index) => {
                    element.style.display = originalDisplays[index];
                });
                button.innerHTML = '📄 Download PDF';
                button.disabled = false;
            });
        });

        // Debug function - Add a test button to check if the page element is being found
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded');
            console.log('Page element:', document.querySelector('.frame'));
            console.log('Form element:', document.getElementById('bookingForm'));
            console.log('Download button:', document.getElementById('downloadPdfBtn'));
            
            // Test if html2pdf is loaded
            if (typeof html2pdf !== 'undefined') {
                console.log('html2pdf loaded successfully');
            } else {
                console.error('html2pdf not loaded!');
            }
        });
    </script>
</body>
</html>